<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ForeignFunctionInterface, EmptyDataDecls, ViewPatterns #-}</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Cipher</span><span class="hs-operator">.</span><span class="hs-identifier">AES128</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span>
</span><a name="line-3"></a><span>        </span><span class="hs-special">(</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKey128"><span class="hs-identifier hs-type">AESKey128</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKey192"><span class="hs-identifier hs-type">AESKey192</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKey256"><span class="hs-identifier hs-type">AESKey256</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#RawKey128"><span class="hs-identifier hs-type">RawKey128</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#RawKey192"><span class="hs-identifier hs-type">RawKey192</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#RawKey256"><span class="hs-identifier hs-type">RawKey256</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCM"><span class="hs-identifier hs-type">GCM</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCMpc"><span class="hs-identifier hs-type">GCMpc</span></a><span>
</span><a name="line-4"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#generateKey128"><span class="hs-identifier hs-var">generateKey128</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#generateKey192"><span class="hs-identifier hs-var">generateKey192</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#generateKey256"><span class="hs-identifier hs-var">generateKey256</span></a><span>
</span><a name="line-5"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#generateGCM"><span class="hs-identifier hs-var">generateGCM</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#precomputeGCMdata"><span class="hs-identifier hs-var">precomputeGCMdata</span></a><span>
</span><a name="line-6"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#encryptECB"><span class="hs-identifier hs-var">encryptECB</span></a><span>
</span><a name="line-7"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#decryptECB"><span class="hs-identifier hs-var">decryptECB</span></a><span>
</span><a name="line-8"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#encryptCTR"><span class="hs-identifier hs-var">encryptCTR</span></a><span>
</span><a name="line-9"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#decryptCTR"><span class="hs-identifier hs-var">decryptCTR</span></a><span>
</span><a name="line-10"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#encryptGCM"><span class="hs-identifier hs-var">encryptGCM</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#decryptGCM"><span class="hs-identifier hs-var">decryptGCM</span></a><span>
</span><a name="line-11"></a><span>        </span><span class="hs-comment">-- * Piece-meal functions</span><span>
</span><a name="line-12"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#cipherOnlyGCM"><span class="hs-identifier hs-var">cipherOnlyGCM</span></a><span>
</span><a name="line-13"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#decipherOnlyGCM"><span class="hs-identifier hs-var">decipherOnlyGCM</span></a><span>
</span><a name="line-14"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#finishGCM"><span class="hs-identifier hs-var">finishGCM</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#aadGCM"><span class="hs-identifier hs-var">aadGCM</span></a><span>
</span><a name="line-15"></a><span>        </span><span class="hs-comment">-- * Internal, will not be exported in a near-future release.</span><span>
</span><a name="line-16"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span>
</span><a name="line-17"></a><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Ptr</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">ForeignPtr</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Storable</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Marshal</span><span class="hs-operator">.</span><span class="hs-identifier">Alloc</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bits</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.|.</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Unsafe</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-comment">-- AES Bindings</span><span>
</span><a name="line-28"></a><span class="hs-keyword">data</span><span> </span><a name="AESKeyStruct"><a href="Crypto.Cipher.AES128.Internal.html#AESKeyStruct"><span class="hs-identifier">AESKeyStruct</span></a></a><span>
</span><a name="line-29"></a><span class="hs-keyword">type</span><span> </span><a name="AESKeyPtr"><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier">AESKeyPtr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyStruct"><span class="hs-identifier hs-type">AESKeyStruct</span></a><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-keyword">data</span><span> </span><a name="RawKey128"><a href="Crypto.Cipher.AES128.Internal.html#RawKey128"><span class="hs-identifier">RawKey128</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="RKey128"><a href="Crypto.Cipher.AES128.Internal.html#RKey128"><span class="hs-identifier">RKey128</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="lowK128"><a href="Crypto.Cipher.AES128.Internal.html#lowK128"><span class="hs-identifier">lowK128</span></a></a><span class="hs-special">,</span><a name="highK128"><a href="Crypto.Cipher.AES128.Internal.html#highK128"><span class="hs-identifier">highK128</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-32"></a><span class="hs-keyword">data</span><span> </span><a name="AESKey128"><a href="Crypto.Cipher.AES128.Internal.html#AESKey128"><span class="hs-identifier">AESKey128</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="AESKey128"><a href="Crypto.Cipher.AES128.Internal.html#AESKey128"><span class="hs-identifier">AESKey128</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="rawKey128"><a href="Crypto.Cipher.AES128.Internal.html#rawKey128"><span class="hs-identifier">rawKey128</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Crypto.Cipher.AES128.Internal.html#RawKey128"><span class="hs-identifier hs-type">RawKey128</span></a><span>
</span><a name="line-33"></a><span>                           </span><span class="hs-special">,</span><span> </span><a name="expandedKey128"><a href="Crypto.Cipher.AES128.Internal.html#expandedKey128"><span class="hs-identifier">expandedKey128</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ForeignPtr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyStruct"><span class="hs-identifier hs-type">AESKeyStruct</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">data</span><span> </span><a name="RawKey192"><a href="Crypto.Cipher.AES128.Internal.html#RawKey192"><span class="hs-identifier">RawKey192</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="RKey192"><a href="Crypto.Cipher.AES128.Internal.html#RKey192"><span class="hs-identifier">RKey192</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="lowK192"><a href="Crypto.Cipher.AES128.Internal.html#lowK192"><span class="hs-identifier">lowK192</span></a></a><span class="hs-special">,</span><a name="midK192"><a href="Crypto.Cipher.AES128.Internal.html#midK192"><span class="hs-identifier">midK192</span></a></a><span class="hs-special">,</span><a name="highK192"><a href="Crypto.Cipher.AES128.Internal.html#highK192"><span class="hs-identifier">highK192</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-36"></a><span class="hs-keyword">data</span><span> </span><a name="AESKey192"><a href="Crypto.Cipher.AES128.Internal.html#AESKey192"><span class="hs-identifier">AESKey192</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="AESKey192"><a href="Crypto.Cipher.AES128.Internal.html#AESKey192"><span class="hs-identifier">AESKey192</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="rawKey192"><a href="Crypto.Cipher.AES128.Internal.html#rawKey192"><span class="hs-identifier">rawKey192</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Crypto.Cipher.AES128.Internal.html#RawKey192"><span class="hs-identifier hs-type">RawKey192</span></a><span>
</span><a name="line-37"></a><span>                           </span><span class="hs-special">,</span><span> </span><a name="expandedKey192"><a href="Crypto.Cipher.AES128.Internal.html#expandedKey192"><span class="hs-identifier">expandedKey192</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ForeignPtr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyStruct"><span class="hs-identifier hs-type">AESKeyStruct</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">data</span><span> </span><a name="RawKey256"><a href="Crypto.Cipher.AES128.Internal.html#RawKey256"><span class="hs-identifier">RawKey256</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="RKey256"><a href="Crypto.Cipher.AES128.Internal.html#RKey256"><span class="hs-identifier">RKey256</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="aK256"><a href="Crypto.Cipher.AES128.Internal.html#aK256"><span class="hs-identifier">aK256</span></a></a><span class="hs-special">,</span><a name="bK256"><a href="Crypto.Cipher.AES128.Internal.html#bK256"><span class="hs-identifier">bK256</span></a></a><span class="hs-special">,</span><a name="cK256"><a href="Crypto.Cipher.AES128.Internal.html#cK256"><span class="hs-identifier">cK256</span></a></a><span class="hs-special">,</span><a name="dK256"><a href="Crypto.Cipher.AES128.Internal.html#dK256"><span class="hs-identifier">dK256</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-40"></a><span class="hs-keyword">data</span><span> </span><a name="AESKey256"><a href="Crypto.Cipher.AES128.Internal.html#AESKey256"><span class="hs-identifier">AESKey256</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="AESKey256"><a href="Crypto.Cipher.AES128.Internal.html#AESKey256"><span class="hs-identifier">AESKey256</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="rawKey256"><a href="Crypto.Cipher.AES128.Internal.html#rawKey256"><span class="hs-identifier">rawKey256</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Crypto.Cipher.AES128.Internal.html#RawKey256"><span class="hs-identifier hs-type">RawKey256</span></a><span>
</span><a name="line-41"></a><span>                           </span><span class="hs-special">,</span><span> </span><a name="expandedKey256"><a href="Crypto.Cipher.AES128.Internal.html#expandedKey256"><span class="hs-identifier">expandedKey256</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ForeignPtr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyStruct"><span class="hs-identifier hs-type">AESKeyStruct</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-keyword">class</span><span> </span><a name="GetExpanded"><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier">GetExpanded</span></a></a><span> </span><a name="local-1627404950"><a href="#local-1627404950"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-44"></a><span>    </span><span class="hs-identifier">expandedKey</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627404950"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ForeignPtr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyStruct"><span class="hs-identifier hs-type">AESKeyStruct</span></a><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKey256"><span class="hs-identifier hs-type">AESKey256</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-47"></a><span>    </span><a name="local-1912617255"><a href="Crypto.Cipher.AES128.Internal.html#expandedKey"><span class="hs-identifier">expandedKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">expandedKey256</span><span>
</span><a name="line-48"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKey192"><span class="hs-identifier hs-type">AESKey192</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-49"></a><span>    </span><a name="local-1912617255"><a href="Crypto.Cipher.AES128.Internal.html#expandedKey"><span class="hs-identifier">expandedKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">expandedKey192</span><span>
</span><a name="line-50"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKey128"><span class="hs-identifier hs-type">AESKey128</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-51"></a><span>    </span><a name="local-1912617255"><a href="Crypto.Cipher.AES128.Internal.html#expandedKey"><span class="hs-identifier">expandedKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">expandedKey128</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-keyword">type</span><span> </span><a name="AESGcmPtr"><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier">AESGcmPtr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCMStruct"><span class="hs-identifier hs-type">GCMStruct</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">data</span><span> </span><a name="GCMStruct"><a href="Crypto.Cipher.AES128.Internal.html#GCMStruct"><span class="hs-identifier">GCMStruct</span></a></a><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">-- Store the key, the precomputed GCM data, and the current IV by way of</span><span>
</span><a name="line-57"></a><span class="hs-comment">-- a foreign pointer</span><span>
</span><a name="line-58"></a><span class="hs-keyword">data</span><span> </span><a name="GCM"><a href="Crypto.Cipher.AES128.Internal.html#GCM"><span class="hs-identifier">GCM</span></a></a><span> </span><a name="local-1627404949"><a href="#local-1627404949"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GCM"><a href="Crypto.Cipher.AES128.Internal.html#GCM"><span class="hs-identifier">GCM</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="_gcmFP"><a href="Crypto.Cipher.AES128.Internal.html#_gcmFP"><span class="hs-identifier">_gcmFP</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCMpc"><span class="hs-identifier hs-type">GCMpc</span></a><span>
</span><a name="line-59"></a><span>                 </span><span class="hs-special">,</span><span> </span><a name="_keyFP"><a href="Crypto.Cipher.AES128.Internal.html#_keyFP"><span class="hs-identifier">_keyFP</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627404949"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-60"></a><span>                 </span><span class="hs-special">,</span><span> </span><a name="_ctxFP2"><a href="Crypto.Cipher.AES128.Internal.html#_ctxFP2"><span class="hs-identifier">_ctxFP2</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ForeignPtr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#CTXStruct"><span class="hs-identifier hs-type">CTXStruct</span></a><span>
</span><a name="line-61"></a><span>                 </span><span class="hs-special">}</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-keyword">newtype</span><span> </span><a name="GCMpc"><a href="Crypto.Cipher.AES128.Internal.html#GCMpc"><span class="hs-identifier">GCMpc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GCMpc"><a href="Crypto.Cipher.AES128.Internal.html#GCMpc"><span class="hs-identifier">GCMpc</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unGCMpc"><a href="Crypto.Cipher.AES128.Internal.html#unGCMpc"><span class="hs-identifier">unGCMpc</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ForeignPtr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCMStruct"><span class="hs-identifier hs-type">GCMStruct</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">type</span><span> </span><a name="AESCtxPtr"><a href="Crypto.Cipher.AES128.Internal.html#AESCtxPtr"><span class="hs-identifier">AESCtxPtr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#CTXStruct"><span class="hs-identifier hs-type">CTXStruct</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">data</span><span> </span><a name="CTXStruct"><a href="Crypto.Cipher.AES128.Internal.html#CTXStruct"><span class="hs-identifier">CTXStruct</span></a></a><span>
</span><a name="line-67"></a><span class="hs-comment">-- data CTX = CTX { _ctxFP :: ForeignPtr CTXStruct }</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_aes_initkey&quot;</span><span>
</span><a name="line-70"></a><span>        </span><span class="hs-identifier">c_aes_initkey</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_allocatekey&quot;</span><span>
</span><a name="line-73"></a><span>        </span><span class="hs-identifier">c_allocate_key</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h &amp;tmd_freekey&quot;</span><span>
</span><a name="line-76"></a><span>        </span><span class="hs-identifier">c_free_key</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FunPtr</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-comment">-- foreign import ccall unsafe &quot;aes.h tmd_freekey&quot;</span><span>
</span><a name="line-79"></a><span class="hs-comment">--         c_key_free :: AESKeyPtr -&gt; IO ()</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_allocatectx&quot;</span><span>
</span><a name="line-82"></a><span>        </span><span class="hs-identifier">c_allocate_ctx</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESCtxPtr"><span class="hs-identifier hs-type">AESCtxPtr</span></a><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h &amp;tmd_freectx&quot;</span><span>
</span><a name="line-85"></a><span>        </span><span class="hs-identifier">c_free_ctx</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FunPtr</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#AESCtxPtr"><span class="hs-identifier hs-type">AESCtxPtr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-comment">-- foreign import ccall unsafe &quot;aes.h tmd_freectx&quot;</span><span>
</span><a name="line-88"></a><span class="hs-comment">--         c_ctx_free :: AESCtxPtr -&gt; IO ()</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_allocategcm&quot;</span><span>
</span><a name="line-91"></a><span>        </span><span class="hs-identifier">c_allocate_gcm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier hs-type">AESGcmPtr</span></a><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h &amp;tmd_freegcm&quot;</span><span>
</span><a name="line-94"></a><span>        </span><span class="hs-identifier">c_free_gcm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FunPtr</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier hs-type">AESGcmPtr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-comment">-- foreign import ccall unsafe &quot;aes.h tmd_freegcm&quot;</span><span>
</span><a name="line-97"></a><span class="hs-comment">--         c_gcm_free :: AESGcmPtr -&gt; IO ()</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_aes_gcm_init&quot;</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-identifier">c_gcm_init</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier hs-type">AESGcmPtr</span></a><span>
</span><a name="line-101"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span>
</span><a name="line-102"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_aes_ctx_init&quot;</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-identifier">c_ctx_init</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier hs-type">AESGcmPtr</span></a><span>
</span><a name="line-106"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESCtxPtr"><span class="hs-identifier hs-type">AESCtxPtr</span></a><span>
</span><a name="line-107"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span>
</span><a name="line-108"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-comment">-- ^ IV and length</span><span>
</span><a name="line-109"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_aes_encrypt_ecb&quot;</span><span>
</span><a name="line-113"></a><span>        </span><span class="hs-identifier">c_encrypt_ecb</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_aes_decrypt_ecb&quot;</span><span>
</span><a name="line-116"></a><span>        </span><span class="hs-identifier">c_decrypt_ecb</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_aes_gcm_finish&quot;</span><span>
</span><a name="line-120"></a><span>    </span><span class="hs-identifier">c_gcm_finish</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>           </span><span class="hs-comment">-- Tag</span><span>
</span><a name="line-121"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier hs-type">AESGcmPtr</span></a><span>
</span><a name="line-122"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span>           </span><span class="hs-comment">-- Key</span><span>
</span><a name="line-123"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESCtxPtr"><span class="hs-identifier hs-type">AESCtxPtr</span></a><span>           </span><span class="hs-comment">-- Context</span><span>
</span><a name="line-124"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_aes_gcm_aad&quot;</span><span>
</span><a name="line-127"></a><span>    </span><span class="hs-identifier">c_gcm_aad</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier hs-type">AESGcmPtr</span></a><span>
</span><a name="line-128"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESCtxPtr"><span class="hs-identifier hs-type">AESCtxPtr</span></a><span>
</span><a name="line-129"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-comment">-- AAD, len</span><span>
</span><a name="line-130"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_aes_gcm_decrypt&quot;</span><span>
</span><a name="line-133"></a><span>    </span><span class="hs-identifier">c_gcm_decrypt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>           </span><span class="hs-comment">-- Output</span><span>
</span><a name="line-134"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier hs-type">AESGcmPtr</span></a><span>
</span><a name="line-135"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESCtxPtr"><span class="hs-identifier hs-type">AESCtxPtr</span></a><span>
</span><a name="line-136"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span>
</span><a name="line-137"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-comment">-- CT and length</span><span>
</span><a name="line-138"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_aes_gcm_encrypt&quot;</span><span>
</span><a name="line-141"></a><span>    </span><span class="hs-identifier">c_gcm_encrypt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>           </span><span class="hs-comment">-- Output</span><span>
</span><a name="line-142"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier hs-type">AESGcmPtr</span></a><span>
</span><a name="line-143"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESCtxPtr"><span class="hs-identifier hs-type">AESCtxPtr</span></a><span>
</span><a name="line-144"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span>
</span><a name="line-145"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-comment">-- PT and length</span><span>
</span><a name="line-146"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_aes_gcm_full_encrypt&quot;</span><span>
</span><a name="line-149"></a><span>    </span><span class="hs-identifier">c_gcm_full_encrypt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier hs-type">AESGcmPtr</span></a><span>
</span><a name="line-150"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span>           </span><span class="hs-comment">-- IV, IVLen</span><span>
</span><a name="line-151"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span>           </span><span class="hs-comment">-- AAD, AADLen</span><span>
</span><a name="line-152"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span>           </span><span class="hs-comment">-- PT, PTLen</span><span>
</span><a name="line-153"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>                     </span><span class="hs-comment">-- CT</span><span>
</span><a name="line-154"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>                     </span><span class="hs-comment">-- Tag</span><span>
</span><a name="line-155"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_aes_gcm_full_decrypt&quot;</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-identifier">c_gcm_full_decrypt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier hs-type">AESGcmPtr</span></a><span>
</span><a name="line-159"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span>           </span><span class="hs-comment">-- IV, IVLen</span><span>
</span><a name="line-160"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span>           </span><span class="hs-comment">-- AAD, AADLen</span><span>
</span><a name="line-161"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span>           </span><span class="hs-comment">-- PT, PTLen</span><span>
</span><a name="line-162"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>                     </span><span class="hs-comment">-- CT</span><span>
</span><a name="line-163"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>                     </span><span class="hs-comment">-- Tag</span><span>
</span><a name="line-164"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;aes.h tmd_aes_encrypt_ctr&quot;</span><span>
</span><a name="line-167"></a><span>    </span><span class="hs-identifier">c_encrypt_ctr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ Output</span><span>
</span><a name="line-168"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span>
</span><a name="line-169"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ 128 bit IV</span><span>
</span><a name="line-170"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ 128 bit new IV</span><span>
</span><a name="line-171"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ Input</span><span>
</span><a name="line-172"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span>    </span><span class="hs-comment">-- ^ Input length in bytes</span><span>
</span><a name="line-173"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span class="hs-identifier">c_decrypt_ctr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ Result</span><span>
</span><a name="line-176"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span>
</span><a name="line-177"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ 128 bit IV</span><span>
</span><a name="line-178"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ 128 bit new IV</span><span>
</span><a name="line-179"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ Input</span><span>
</span><a name="line-180"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span>    </span><span class="hs-comment">-- ^ Input length in bytes</span><span>
</span><a name="line-181"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-182"></a><a name="c_decrypt_ctr"><a href="Crypto.Cipher.AES128.Internal.html#c_decrypt_ctr"><span class="hs-identifier">c_decrypt_ctr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_encrypt_ctr"><span class="hs-identifier hs-var">c_encrypt_ctr</span></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-identifier">blkSzC</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span>
</span><a name="line-185"></a><a name="blkSzC"><a href="Crypto.Cipher.AES128.Internal.html#blkSzC"><span class="hs-identifier">blkSzC</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">16</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-comment">-- Given a 16 byte buffer, allocate and return an AESKey</span><span>
</span><a name="line-188"></a><span class="hs-identifier">generateKey128</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-189"></a><span>            </span><span class="hs-comment">-- ^ Buffer of 16 bytes of key material</span><span>
</span><a name="line-190"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKey128"><span class="hs-identifier hs-type">AESKey128</span></a><span class="hs-special">)</span><span>
</span><a name="line-191"></a><a name="generateKey128"><a href="Crypto.Cipher.AES128.Internal.html#generateKey128"><span class="hs-identifier">generateKey128</span></a></a><span> </span><a name="local-1627406267"><a href="#local-1627406267"><span class="hs-identifier">keyPtr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-192"></a><span>    </span><a name="local-1627406827"><a href="#local-1627406827"><span class="hs-identifier">raw</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-193"></a><span>            </span><a name="local-1627406824"><a href="#local-1627406824"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627406268"><span class="hs-identifier hs-var">peekLE</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-1627406267"><span class="hs-identifier hs-var">keyPtr</span></a><span class="hs-special">)</span><span>
</span><a name="line-194"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406825"><a href="#local-1627406825"><span class="hs-identifier">keyPtr2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-1627406267"><span class="hs-identifier hs-var">keyPtr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">sizeOf</span><span> </span><a href="#local-1627406824"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-195"></a><span>            </span><a name="local-1627406826"><a href="#local-1627406826"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627406268"><span class="hs-identifier hs-var">peekLE</span></a><span> </span><a href="#local-1627406825"><span class="hs-identifier hs-var">keyPtr2</span></a><span>
</span><a name="line-196"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#RKey128"><span class="hs-identifier hs-var">RKey128</span></a><span> </span><a href="#local-1627406826"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-1627406824"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-197"></a><span>    </span><a name="local-1627406828"><a href="#local-1627406828"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_allocate_key"><span class="hs-identifier hs-var">c_allocate_key</span></a><span>
</span><a name="line-198"></a><span>    </span><a href="Crypto.Cipher.AES128.Internal.html#c_aes_initkey"><span class="hs-identifier hs-var">c_aes_initkey</span></a><span> </span><a href="#local-1627406828"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-1627406267"><span class="hs-identifier hs-var">keyPtr</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">16</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKey128"><span class="hs-identifier hs-var">AESKey128</span></a><span> </span><a href="#local-1627406827"><span class="hs-identifier hs-var">raw</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">newForeignPtr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_free_key"><span class="hs-identifier hs-var">c_free_key</span></a><span> </span><a href="#local-1627406828"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-201"></a><span>     </span><span class="hs-identifier">peekLE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-202"></a><span>     </span><a name="local-1627406268"><a href="#local-1627406268"><span class="hs-identifier">peekLE</span></a></a><span> </span><a name="local-1627406269"><a href="#local-1627406269"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-203"></a><span>        </span><a name="local-1627406270"><a href="#local-1627406270"><span class="hs-identifier">a1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406269"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-204"></a><span>        </span><a name="local-1627406271"><a href="#local-1627406271"><span class="hs-identifier">a2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406269"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-205"></a><span>        </span><a name="local-1627406272"><a href="#local-1627406272"><span class="hs-identifier">a3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406269"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-206"></a><span>        </span><a name="local-1627406273"><a href="#local-1627406273"><span class="hs-identifier">a4</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406269"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">3</span><span>
</span><a name="line-207"></a><span>        </span><a name="local-1627406274"><a href="#local-1627406274"><span class="hs-identifier">a5</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406269"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">4</span><span>
</span><a name="line-208"></a><span>        </span><a name="local-1627406275"><a href="#local-1627406275"><span class="hs-identifier">a6</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406269"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">5</span><span>
</span><a name="line-209"></a><span>        </span><a name="local-1627406276"><a href="#local-1627406276"><span class="hs-identifier">a7</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406269"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">6</span><span>
</span><a name="line-210"></a><span>        </span><a name="local-1627406277"><a href="#local-1627406277"><span class="hs-identifier">a8</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406269"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">7</span><span>
</span><a name="line-211"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406278"><a href="#local-1627406278"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627406279"><a href="#local-1627406279"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1627406280"><a href="#local-1627406280"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627406279"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><a href="#local-1627406280"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-212"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406823"><a href="#local-1627406823"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627406278"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406270"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-number">56</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-1627406278"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406271"><span class="hs-identifier hs-var">a2</span></a><span> </span><span class="hs-number">48</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-1627406278"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406272"><span class="hs-identifier hs-var">a3</span></a><span> </span><span class="hs-number">40</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span>
</span><a name="line-213"></a><span>                </span><span class="hs-special">(</span><a href="#local-1627406278"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406273"><span class="hs-identifier hs-var">a4</span></a><span> </span><span class="hs-number">32</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-1627406278"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406274"><span class="hs-identifier hs-var">a5</span></a><span> </span><span class="hs-number">24</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-1627406278"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406275"><span class="hs-identifier hs-var">a6</span></a><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span>
</span><a name="line-214"></a><span>                </span><span class="hs-special">(</span><a href="#local-1627406278"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406276"><span class="hs-identifier hs-var">a7</span></a><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>  </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627406277"><span class="hs-identifier hs-var">a8</span></a><span>
</span><a name="line-215"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627406823"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-216"></a><span class="hs-pragma">{-# INLINE generateKey128 #-}</span><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-comment">-- Given a 16 byte buffer, allocate and return an AESKey</span><span>
</span><a name="line-219"></a><span class="hs-identifier">generateKey192</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-220"></a><span>            </span><span class="hs-comment">-- ^ Buffer of 16 bytes of key material</span><span>
</span><a name="line-221"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKey192"><span class="hs-identifier hs-type">AESKey192</span></a><span class="hs-special">)</span><span>
</span><a name="line-222"></a><a name="generateKey192"><a href="Crypto.Cipher.AES128.Internal.html#generateKey192"><span class="hs-identifier">generateKey192</span></a></a><span> </span><a name="local-1627406856"><a href="#local-1627406856"><span class="hs-identifier">keyPtr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-223"></a><span>    </span><a name="local-1627406876"><a href="#local-1627406876"><span class="hs-identifier">raw</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-224"></a><span>            </span><a name="local-1627406871"><a href="#local-1627406871"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627406857"><span class="hs-identifier hs-var">peekLE</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-1627406856"><span class="hs-identifier hs-var">keyPtr</span></a><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406872"><a href="#local-1627406872"><span class="hs-identifier">keyPtr2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-1627406856"><span class="hs-identifier hs-var">keyPtr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">sizeOf</span><span> </span><a href="#local-1627406871"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-226"></a><span>            </span><a name="local-1627406873"><a href="#local-1627406873"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627406857"><span class="hs-identifier hs-var">peekLE</span></a><span> </span><a href="#local-1627406872"><span class="hs-identifier hs-var">keyPtr2</span></a><span>
</span><a name="line-227"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406874"><a href="#local-1627406874"><span class="hs-identifier">keyPtr3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-1627406856"><span class="hs-identifier hs-var">keyPtr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">sizeOf</span><span> </span><a href="#local-1627406871"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">sizeOf</span><span> </span><a href="#local-1627406873"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-228"></a><span>            </span><a name="local-1627406875"><a href="#local-1627406875"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627406857"><span class="hs-identifier hs-var">peekLE</span></a><span> </span><a href="#local-1627406874"><span class="hs-identifier hs-var">keyPtr3</span></a><span>
</span><a name="line-229"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#RKey192"><span class="hs-identifier hs-var">RKey192</span></a><span> </span><a href="#local-1627406875"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-1627406873"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-1627406871"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-230"></a><span>    </span><a name="local-1627406877"><a href="#local-1627406877"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_allocate_key"><span class="hs-identifier hs-var">c_allocate_key</span></a><span>
</span><a name="line-231"></a><span>    </span><a href="Crypto.Cipher.AES128.Internal.html#c_aes_initkey"><span class="hs-identifier hs-var">c_aes_initkey</span></a><span> </span><a href="#local-1627406877"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-1627406856"><span class="hs-identifier hs-var">keyPtr</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">24</span><span>
</span><a name="line-232"></a><span>    </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKey192"><span class="hs-identifier hs-var">AESKey192</span></a><span> </span><a href="#local-1627406876"><span class="hs-identifier hs-var">raw</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">newForeignPtr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_free_key"><span class="hs-identifier hs-var">c_free_key</span></a><span> </span><a href="#local-1627406877"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-234"></a><span>     </span><span class="hs-identifier">peekLE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-235"></a><span>     </span><a name="local-1627406857"><a href="#local-1627406857"><span class="hs-identifier">peekLE</span></a></a><span> </span><a name="local-1627406858"><a href="#local-1627406858"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-236"></a><span>        </span><a name="local-1627406859"><a href="#local-1627406859"><span class="hs-identifier">a1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406858"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-237"></a><span>        </span><a name="local-1627406860"><a href="#local-1627406860"><span class="hs-identifier">a2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406858"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-238"></a><span>        </span><a name="local-1627406861"><a href="#local-1627406861"><span class="hs-identifier">a3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406858"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-239"></a><span>        </span><a name="local-1627406862"><a href="#local-1627406862"><span class="hs-identifier">a4</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406858"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">3</span><span>
</span><a name="line-240"></a><span>        </span><a name="local-1627406863"><a href="#local-1627406863"><span class="hs-identifier">a5</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406858"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">4</span><span>
</span><a name="line-241"></a><span>        </span><a name="local-1627406864"><a href="#local-1627406864"><span class="hs-identifier">a6</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406858"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">5</span><span>
</span><a name="line-242"></a><span>        </span><a name="local-1627406865"><a href="#local-1627406865"><span class="hs-identifier">a7</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406858"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">6</span><span>
</span><a name="line-243"></a><span>        </span><a name="local-1627406866"><a href="#local-1627406866"><span class="hs-identifier">a8</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406858"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">7</span><span>
</span><a name="line-244"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406867"><a href="#local-1627406867"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627406868"><a href="#local-1627406868"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1627406869"><a href="#local-1627406869"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627406868"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><a href="#local-1627406869"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-245"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406870"><a href="#local-1627406870"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627406867"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406859"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-number">56</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-1627406867"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406860"><span class="hs-identifier hs-var">a2</span></a><span> </span><span class="hs-number">48</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-1627406867"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406861"><span class="hs-identifier hs-var">a3</span></a><span> </span><span class="hs-number">40</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span>
</span><a name="line-246"></a><span>                </span><span class="hs-special">(</span><a href="#local-1627406867"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406862"><span class="hs-identifier hs-var">a4</span></a><span> </span><span class="hs-number">32</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-1627406867"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406863"><span class="hs-identifier hs-var">a5</span></a><span> </span><span class="hs-number">24</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-1627406867"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406864"><span class="hs-identifier hs-var">a6</span></a><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span>
</span><a name="line-247"></a><span>                </span><span class="hs-special">(</span><a href="#local-1627406867"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406865"><span class="hs-identifier hs-var">a7</span></a><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>  </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627406866"><span class="hs-identifier hs-var">a8</span></a><span>
</span><a name="line-248"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627406870"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-249"></a><span class="hs-pragma">{-# INLINE generateKey192 #-}</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-comment">-- Given a 16 byte buffer, allocate and return an AESKey</span><span>
</span><a name="line-252"></a><span class="hs-identifier">generateKey256</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-253"></a><span>            </span><span class="hs-comment">-- ^ Buffer of 16 bytes of key material</span><span>
</span><a name="line-254"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKey256"><span class="hs-identifier hs-type">AESKey256</span></a><span class="hs-special">)</span><span>
</span><a name="line-255"></a><a name="generateKey256"><a href="Crypto.Cipher.AES128.Internal.html#generateKey256"><span class="hs-identifier">generateKey256</span></a></a><span> </span><a name="local-1627406878"><a href="#local-1627406878"><span class="hs-identifier">keyPtr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-256"></a><span>    </span><a name="local-1627406900"><a href="#local-1627406900"><span class="hs-identifier">raw</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-257"></a><span>            </span><a name="local-1627406893"><a href="#local-1627406893"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627406879"><span class="hs-identifier hs-var">peekLE</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-1627406878"><span class="hs-identifier hs-var">keyPtr</span></a><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406894"><a href="#local-1627406894"><span class="hs-identifier">keyPtr2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-1627406878"><span class="hs-identifier hs-var">keyPtr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">sizeOf</span><span> </span><a href="#local-1627406893"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-259"></a><span>            </span><a name="local-1627406895"><a href="#local-1627406895"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627406879"><span class="hs-identifier hs-var">peekLE</span></a><span> </span><a href="#local-1627406894"><span class="hs-identifier hs-var">keyPtr2</span></a><span>
</span><a name="line-260"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406896"><a href="#local-1627406896"><span class="hs-identifier">keyPtr3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-1627406878"><span class="hs-identifier hs-var">keyPtr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">sizeOf</span><span> </span><a href="#local-1627406893"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">sizeOf</span><span> </span><a href="#local-1627406895"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-261"></a><span>            </span><a name="local-1627406897"><a href="#local-1627406897"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627406879"><span class="hs-identifier hs-var">peekLE</span></a><span> </span><a href="#local-1627406896"><span class="hs-identifier hs-var">keyPtr3</span></a><span>
</span><a name="line-262"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406898"><a href="#local-1627406898"><span class="hs-identifier">keyPtr4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-1627406878"><span class="hs-identifier hs-var">keyPtr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">sizeOf</span><span> </span><a href="#local-1627406893"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">sizeOf</span><span> </span><a href="#local-1627406895"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">sizeOf</span><span> </span><a href="#local-1627406897"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-263"></a><span>            </span><a name="local-1627406899"><a href="#local-1627406899"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627406879"><span class="hs-identifier hs-var">peekLE</span></a><span> </span><a href="#local-1627406898"><span class="hs-identifier hs-var">keyPtr4</span></a><span>
</span><a name="line-264"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#RKey256"><span class="hs-identifier hs-var">RKey256</span></a><span> </span><a href="#local-1627406899"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="#local-1627406897"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-1627406895"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-1627406893"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>    </span><a name="local-1627406901"><a href="#local-1627406901"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_allocate_key"><span class="hs-identifier hs-var">c_allocate_key</span></a><span>
</span><a name="line-266"></a><span>    </span><a href="Crypto.Cipher.AES128.Internal.html#c_aes_initkey"><span class="hs-identifier hs-var">c_aes_initkey</span></a><span> </span><a href="#local-1627406901"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-1627406878"><span class="hs-identifier hs-var">keyPtr</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">32</span><span>
</span><a name="line-267"></a><span>    </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKey256"><span class="hs-identifier hs-var">AESKey256</span></a><span> </span><a href="#local-1627406900"><span class="hs-identifier hs-var">raw</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">newForeignPtr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_free_key"><span class="hs-identifier hs-var">c_free_key</span></a><span> </span><a href="#local-1627406901"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-268"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-269"></a><span>     </span><span class="hs-identifier">peekLE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-270"></a><span>     </span><a name="local-1627406879"><a href="#local-1627406879"><span class="hs-identifier">peekLE</span></a></a><span> </span><a name="local-1627406880"><a href="#local-1627406880"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-271"></a><span>        </span><a name="local-1627406881"><a href="#local-1627406881"><span class="hs-identifier">a1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406880"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-272"></a><span>        </span><a name="local-1627406882"><a href="#local-1627406882"><span class="hs-identifier">a2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406880"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-273"></a><span>        </span><a name="local-1627406883"><a href="#local-1627406883"><span class="hs-identifier">a3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406880"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-274"></a><span>        </span><a name="local-1627406884"><a href="#local-1627406884"><span class="hs-identifier">a4</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406880"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">3</span><span>
</span><a name="line-275"></a><span>        </span><a name="local-1627406885"><a href="#local-1627406885"><span class="hs-identifier">a5</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406880"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">4</span><span>
</span><a name="line-276"></a><span>        </span><a name="local-1627406886"><a href="#local-1627406886"><span class="hs-identifier">a6</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406880"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">5</span><span>
</span><a name="line-277"></a><span>        </span><a name="local-1627406887"><a href="#local-1627406887"><span class="hs-identifier">a7</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406880"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">6</span><span>
</span><a name="line-278"></a><span>        </span><a name="local-1627406888"><a href="#local-1627406888"><span class="hs-identifier">a8</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekElemOff</span><span> </span><a href="#local-1627406880"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">7</span><span>
</span><a name="line-279"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406889"><a href="#local-1627406889"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627406890"><a href="#local-1627406890"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1627406891"><a href="#local-1627406891"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627406890"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><a href="#local-1627406891"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-280"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406892"><a href="#local-1627406892"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627406889"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406881"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-number">56</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-1627406889"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406882"><span class="hs-identifier hs-var">a2</span></a><span> </span><span class="hs-number">48</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-1627406889"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406883"><span class="hs-identifier hs-var">a3</span></a><span> </span><span class="hs-number">40</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span>
</span><a name="line-281"></a><span>                </span><span class="hs-special">(</span><a href="#local-1627406889"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406884"><span class="hs-identifier hs-var">a4</span></a><span> </span><span class="hs-number">32</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-1627406889"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406885"><span class="hs-identifier hs-var">a5</span></a><span> </span><span class="hs-number">24</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-1627406889"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406886"><span class="hs-identifier hs-var">a6</span></a><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span>
</span><a name="line-282"></a><span>                </span><span class="hs-special">(</span><a href="#local-1627406889"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627406887"><span class="hs-identifier hs-var">a7</span></a><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>  </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627406888"><span class="hs-identifier hs-var">a8</span></a><span>
</span><a name="line-283"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627406892"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-284"></a><span class="hs-pragma">{-# INLINE generateKey256 #-}</span><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-comment">-- Given a 16 byte buffer, allocate and return an key expansion useful for</span><span>
</span><a name="line-287"></a><span class="hs-comment">-- GCM</span><span>
</span><a name="line-288"></a><span class="hs-identifier">generateGCM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627406266"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-289"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627406266"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-290"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#GCM"><span class="hs-identifier hs-type">GCM</span></a><span> </span><a href="#local-1627406266"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-291"></a><a name="generateGCM"><a href="Crypto.Cipher.AES128.Internal.html#generateGCM"><span class="hs-identifier">generateGCM</span></a></a><span> </span><a name="local-1627406902"><a href="#local-1627406902"><span class="hs-identifier">keyStruct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-292"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1627406903"><a href="#local-1627406903"><span class="hs-identifier">gcmPC</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#precomputeGCMdata"><span class="hs-identifier hs-var">precomputeGCMdata</span></a><span> </span><a href="#local-1627406902"><span class="hs-identifier hs-var">keyStruct</span></a><span>
</span><a name="line-293"></a><span>    </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#expandedKey"><span class="hs-identifier hs-var">expandedKey</span></a><span> </span><a href="#local-1627406902"><span class="hs-identifier hs-var">keyStruct</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627406904"><a href="#local-1627406904"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-294"></a><span>      </span><a name="local-1627406905"><a href="#local-1627406905"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_allocate_ctx"><span class="hs-identifier hs-var">c_allocate_ctx</span></a><span>
</span><a name="line-295"></a><span>      </span><span class="hs-identifier hs-var">allocaBytes</span><span> </span><span class="hs-number">12</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627406906"><a href="#local-1627406906"><span class="hs-identifier">ivPtr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#withGCMpc"><span class="hs-identifier hs-var">withGCMpc</span></a><span> </span><a href="#local-1627406903"><span class="hs-identifier hs-var">gcmPC</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627406907"><a href="#local-1627406907"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-296"></a><span>          </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627407984"><a href="#local-1627407984"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pokeElemOff</span><span> </span><a href="#local-1627406906"><span class="hs-identifier hs-var">ivPtr</span></a><span> </span><a href="#local-1627407984"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-number">11</span><span class="hs-special">]</span><span>
</span><a name="line-297"></a><span>          </span><a href="Crypto.Cipher.AES128.Internal.html#c_ctx_init"><span class="hs-identifier hs-var">c_ctx_init</span></a><span> </span><a href="#local-1627406907"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627406905"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-1627406904"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1627406906"><span class="hs-identifier hs-var">ivPtr</span></a><span> </span><span class="hs-number">12</span><span>
</span><a name="line-298"></a><span>      </span><a name="local-1627407985"><a href="#local-1627407985"><span class="hs-identifier">cFP</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newForeignPtr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_free_ctx"><span class="hs-identifier hs-var">c_free_ctx</span></a><span> </span><a href="#local-1627406905"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-299"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#GCM"><span class="hs-identifier hs-var">GCM</span></a><span> </span><a href="#local-1627406903"><span class="hs-identifier hs-var">gcmPC</span></a><span> </span><a href="#local-1627406902"><span class="hs-identifier hs-var">keyStruct</span></a><span> </span><a href="#local-1627407985"><span class="hs-identifier hs-var">cFP</span></a><span class="hs-special">)</span><span>
</span><a name="line-300"></a><span class="hs-pragma">{-# INLINE generateGCM #-}</span><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span class="hs-identifier">precomputeGCMdata</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627406265"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627406265"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCMpc"><span class="hs-identifier hs-type">GCMpc</span></a><span>
</span><a name="line-303"></a><a name="precomputeGCMdata"><a href="Crypto.Cipher.AES128.Internal.html#precomputeGCMdata"><span class="hs-identifier">precomputeGCMdata</span></a></a><span> </span><a name="local-1627407986"><a href="#local-1627407986"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafePerformIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-304"></a><span>    </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#expandedKey"><span class="hs-identifier hs-var">expandedKey</span></a><span> </span><a href="#local-1627407986"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627408000"><a href="#local-1627408000"><span class="hs-identifier">kp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-305"></a><span>        </span><a name="local-1627408001"><a href="#local-1627408001"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_allocate_gcm"><span class="hs-identifier hs-var">c_allocate_gcm</span></a><span>
</span><a name="line-306"></a><span>        </span><a href="Crypto.Cipher.AES128.Internal.html#c_gcm_init"><span class="hs-identifier hs-var">c_gcm_init</span></a><span> </span><a href="#local-1627408001"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627408000"><span class="hs-identifier hs-var">kp</span></a><span>
</span><a name="line-307"></a><span>        </span><a name="local-1627408002"><a href="#local-1627408002"><span class="hs-identifier">gFP</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newForeignPtr</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_free_gcm"><span class="hs-identifier hs-var">c_free_gcm</span></a><span> </span><a href="#local-1627408001"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-308"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#GCMpc"><span class="hs-identifier hs-var">GCMpc</span></a><span> </span><a href="#local-1627408002"><span class="hs-identifier hs-var">gFP</span></a><span class="hs-special">)</span><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span class="hs-identifier">withGCMpc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCMpc"><span class="hs-identifier hs-type">GCMpc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier hs-type">AESGcmPtr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1627406264"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1627406264"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-311"></a><a name="withGCMpc"><a href="Crypto.Cipher.AES128.Internal.html#withGCMpc"><span class="hs-identifier">withGCMpc</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#GCMpc"><span class="hs-identifier hs-var">GCMpc</span></a><span> </span><a name="local-1627408003"><a href="#local-1627408003"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><a href="#local-1627408003"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span class="hs-comment">-- An encrypt function that can handle up to blks &lt; maxBound `div` 16 :: Word32</span><span>
</span><a name="line-314"></a><span class="hs-comment">-- simultaneous blocks.</span><span>
</span><a name="line-315"></a><span class="hs-identifier">encryptECB</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627406263"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-316"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627406263"><span class="hs-identifier hs-type">k</span></a><span>         </span><span class="hs-comment">-- ^ The key</span><span>
</span><a name="line-317"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ The result buffer</span><span>
</span><a name="line-318"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ The source buffer</span><span>
</span><a name="line-319"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>       </span><span class="hs-comment">-- ^ The input size in blocks</span><span>
</span><a name="line-320"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-321"></a><a name="encryptECB"><a href="Crypto.Cipher.AES128.Internal.html#encryptECB"><span class="hs-identifier">encryptECB</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#expandedKey"><span class="hs-identifier hs-var">expandedKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-1627408004"><a href="#local-1627408004"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627408005"><a href="#local-1627408005"><span class="hs-identifier">dst</span></a></a><span> </span><a name="local-1627408006"><a href="#local-1627408006"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-1627408007"><a href="#local-1627408007"><span class="hs-identifier">blks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><a href="#local-1627408004"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627408008"><a href="#local-1627408008"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_encrypt_ecb"><span class="hs-identifier hs-var">c_encrypt_ecb</span></a><span> </span><a href="#local-1627408005"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-1627408008"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627408006"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627408007"><span class="hs-identifier hs-var">blks</span></a><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span class="hs-pragma">{-# INLINE encryptECB #-}</span><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span class="hs-identifier">decryptECB</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627406262"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-325"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627406262"><span class="hs-identifier hs-type">k</span></a><span>         </span><span class="hs-comment">-- ^ The key</span><span>
</span><a name="line-326"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ The result buffer</span><span>
</span><a name="line-327"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ The source buffer</span><span>
</span><a name="line-328"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>       </span><span class="hs-comment">-- ^ The input size in blocks</span><span>
</span><a name="line-329"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-330"></a><a name="decryptECB"><a href="Crypto.Cipher.AES128.Internal.html#decryptECB"><span class="hs-identifier">decryptECB</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#expandedKey"><span class="hs-identifier hs-var">expandedKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-1627408009"><a href="#local-1627408009"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627408010"><a href="#local-1627408010"><span class="hs-identifier">dst</span></a></a><span> </span><a name="local-1627408011"><a href="#local-1627408011"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-1627408012"><a href="#local-1627408012"><span class="hs-identifier">blks</span></a></a><span>
</span><a name="line-331"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627408012"><span class="hs-identifier hs-var">blks</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#blkSzC"><span class="hs-identifier hs-var">blkSzC</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Can not decrypt so many blocks at once&quot;</span><span>
</span><a name="line-332"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><a href="#local-1627408009"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627412003"><a href="#local-1627412003"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_decrypt_ecb"><span class="hs-identifier hs-var">c_decrypt_ecb</span></a><span> </span><a href="#local-1627408010"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-1627412003"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627408011"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627408012"><span class="hs-identifier hs-var">blks</span></a><span class="hs-special">)</span><span>
</span><a name="line-333"></a><span class="hs-pragma">{-# INLINE decryptECB #-}</span><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-identifier">aadGCM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627406261"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCM"><span class="hs-identifier hs-type">GCM</span></a><span> </span><a href="#local-1627406261"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-336"></a><a name="aadGCM"><a href="Crypto.Cipher.AES128.Internal.html#aadGCM"><span class="hs-identifier">aadGCM</span></a></a><span> </span><a name="local-1627412004"><a href="#local-1627412004"><span class="hs-identifier">gcm</span></a></a><span> </span><a name="local-1627412005"><a href="#local-1627412005"><span class="hs-identifier">aad</span></a></a><span> </span><a name="local-1627412006"><a href="#local-1627412006"><span class="hs-identifier">aadLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#withForeignGCM"><span class="hs-identifier hs-var">withForeignGCM</span></a><span> </span><a href="#local-1627412004"><span class="hs-identifier hs-var">gcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627412007"><a href="#local-1627412007"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><a name="local-1627412008"><a href="#local-1627412008"><span class="hs-identifier">_k</span></a></a><span class="hs-special">,</span><a name="local-1627412009"><a href="#local-1627412009"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-337"></a><span>    </span><a href="Crypto.Cipher.AES128.Internal.html#c_gcm_aad"><span class="hs-identifier hs-var">c_gcm_aad</span></a><span> </span><a href="#local-1627412007"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627412009"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-1627412005"><span class="hs-identifier hs-var">aad</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627412006"><span class="hs-identifier hs-var">aadLen</span></a><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span class="hs-identifier">cipherOnlyGCM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627406260"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-340"></a><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCM"><span class="hs-identifier hs-type">GCM</span></a><span> </span><a href="#local-1627406260"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-341"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>         </span><span class="hs-comment">-- CT  (length assumed to match PT)</span><span>
</span><a name="line-342"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>  </span><span class="hs-comment">-- PT and length</span><span>
</span><a name="line-343"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-344"></a><a name="cipherOnlyGCM"><a href="Crypto.Cipher.AES128.Internal.html#cipherOnlyGCM"><span class="hs-identifier">cipherOnlyGCM</span></a></a><span> </span><a name="local-1627412010"><a href="#local-1627412010"><span class="hs-identifier">gcm</span></a></a><span> </span><a name="local-1627412011"><a href="#local-1627412011"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1627412012"><a href="#local-1627412012"><span class="hs-identifier">pt</span></a></a><span> </span><a name="local-1627412013"><a href="#local-1627412013"><span class="hs-identifier">ptlen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#withForeignGCM"><span class="hs-identifier hs-var">withForeignGCM</span></a><span> </span><a href="#local-1627412010"><span class="hs-identifier hs-var">gcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627412014"><a href="#local-1627412014"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><a name="local-1627412015"><a href="#local-1627412015"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-1627412016"><a href="#local-1627412016"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-345"></a><span>    </span><a href="Crypto.Cipher.AES128.Internal.html#c_gcm_encrypt"><span class="hs-identifier hs-var">c_gcm_encrypt</span></a><span> </span><a href="#local-1627412011"><span class="hs-identifier hs-var">ct</span></a><span> </span><a href="#local-1627412014"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627412016"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-1627412015"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1627412012"><span class="hs-identifier hs-var">pt</span></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627412013"><span class="hs-identifier hs-var">ptlen</span></a><span class="hs-special">)</span><span>
</span><a name="line-346"></a><span>
</span><a name="line-347"></a><span class="hs-identifier">decipherOnlyGCM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627406259"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-348"></a><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCM"><span class="hs-identifier hs-type">GCM</span></a><span> </span><a href="#local-1627406259"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-349"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>         </span><span class="hs-comment">-- PT (length assumed to match CT)</span><span>
</span><a name="line-350"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>  </span><span class="hs-comment">-- CT and length</span><span>
</span><a name="line-351"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-352"></a><a name="decipherOnlyGCM"><a href="Crypto.Cipher.AES128.Internal.html#decipherOnlyGCM"><span class="hs-identifier">decipherOnlyGCM</span></a></a><span> </span><a name="local-1627412017"><a href="#local-1627412017"><span class="hs-identifier">gcm</span></a></a><span> </span><a name="local-1627412018"><a href="#local-1627412018"><span class="hs-identifier">pt</span></a></a><span> </span><a name="local-1627412019"><a href="#local-1627412019"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1627412020"><a href="#local-1627412020"><span class="hs-identifier">ctlen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#withForeignGCM"><span class="hs-identifier hs-var">withForeignGCM</span></a><span> </span><a href="#local-1627412017"><span class="hs-identifier hs-var">gcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627412021"><a href="#local-1627412021"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><a name="local-1627412022"><a href="#local-1627412022"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-1627412023"><a href="#local-1627412023"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-353"></a><span>    </span><a href="Crypto.Cipher.AES128.Internal.html#c_gcm_decrypt"><span class="hs-identifier hs-var">c_gcm_decrypt</span></a><span> </span><a href="#local-1627412018"><span class="hs-identifier hs-var">pt</span></a><span> </span><a href="#local-1627412021"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627412023"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-1627412022"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1627412019"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627412020"><span class="hs-identifier hs-var">ctlen</span></a><span class="hs-special">)</span><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span class="hs-identifier">finishGCM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627406258"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-356"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCM"><span class="hs-identifier hs-type">GCM</span></a><span> </span><a href="#local-1627406258"><span class="hs-identifier hs-type">k</span></a><span>     </span><span class="hs-comment">-- GCM context (which is mutated!)</span><span>
</span><a name="line-357"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- Tag, must point to 16 byte buffer (or larger)</span><span>
</span><a name="line-358"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-359"></a><a name="finishGCM"><a href="Crypto.Cipher.AES128.Internal.html#finishGCM"><span class="hs-identifier">finishGCM</span></a></a><span> </span><a name="local-1627412024"><a href="#local-1627412024"><span class="hs-identifier">gcm</span></a></a><span> </span><a name="local-1627412025"><a href="#local-1627412025"><span class="hs-identifier">tagPtr</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-360"></a><span>    </span><a href="Crypto.Cipher.AES128.Internal.html#withForeignGCM"><span class="hs-identifier hs-var">withForeignGCM</span></a><span> </span><a href="#local-1627412024"><span class="hs-identifier hs-var">gcm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627412026"><a href="#local-1627412026"><span class="hs-identifier">gp</span></a></a><span class="hs-special">,</span><a name="local-1627412027"><a href="#local-1627412027"><span class="hs-identifier">kp</span></a></a><span class="hs-special">,</span><a name="local-1627412028"><a href="#local-1627412028"><span class="hs-identifier">cp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#c_gcm_finish"><span class="hs-identifier hs-var">c_gcm_finish</span></a><span> </span><a href="#local-1627412025"><span class="hs-identifier hs-var">tagPtr</span></a><span> </span><a href="#local-1627412026"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1627412027"><span class="hs-identifier hs-var">kp</span></a><span> </span><a href="#local-1627412028"><span class="hs-identifier hs-var">cp</span></a><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-identifier">withForeignGCM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627406256"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCM"><span class="hs-identifier hs-type">GCM</span></a><span> </span><a href="#local-1627406256"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#AESGcmPtr"><span class="hs-identifier hs-type">AESGcmPtr</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESKeyPtr"><span class="hs-identifier hs-type">AESKeyPtr</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#AESCtxPtr"><span class="hs-identifier hs-type">AESCtxPtr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1627406257"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1627406257"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-363"></a><a name="withForeignGCM"><a href="Crypto.Cipher.AES128.Internal.html#withForeignGCM"><span class="hs-identifier">withForeignGCM</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#GCM"><span class="hs-identifier hs-var">GCM</span></a><span> </span><a name="local-1627412029"><a href="#local-1627412029"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627412030"><a href="#local-1627412030"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627412031"><a href="#local-1627412031"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627412032"><a href="#local-1627412032"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-364"></a><span>    </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unGCMpc</span><span> </span><a href="#local-1627412029"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627412033"><a href="#local-1627412033"><span class="hs-identifier">gp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#expandedKey"><span class="hs-identifier hs-var">expandedKey</span></a><span> </span><a href="#local-1627412030"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627412034"><a href="#local-1627412034"><span class="hs-identifier">kp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><a href="#local-1627412031"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627412035"><a href="#local-1627412035"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627412032"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627412033"><span class="hs-identifier hs-var">gp</span></a><span class="hs-special">,</span><a href="#local-1627412034"><span class="hs-identifier hs-var">kp</span></a><span class="hs-special">,</span><a href="#local-1627412035"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-identifier">encryptCTR</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627406255"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-367"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627406255"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-368"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ IV</span><span>
</span><a name="line-369"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ NEW IV</span><span>
</span><a name="line-370"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ CT</span><span>
</span><a name="line-371"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ PT</span><span>
</span><a name="line-372"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>       </span><span class="hs-comment">-- ^ Length in bytes</span><span>
</span><a name="line-373"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-374"></a><a name="encryptCTR"><a href="Crypto.Cipher.AES128.Internal.html#encryptCTR"><span class="hs-identifier">encryptCTR</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#expandedKey"><span class="hs-identifier hs-var">expandedKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-1627412036"><a href="#local-1627412036"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627412037"><a href="#local-1627412037"><span class="hs-identifier">iv</span></a></a><span> </span><a name="local-1627412038"><a href="#local-1627412038"><span class="hs-identifier">niv</span></a></a><span> </span><a name="local-1627412039"><a href="#local-1627412039"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1627412040"><a href="#local-1627412040"><span class="hs-identifier">pt</span></a></a><span> </span><a name="local-1627412041"><a href="#local-1627412041"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><a href="#local-1627412036"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627412042"><a href="#local-1627412042"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-375"></a><span>    </span><a href="Crypto.Cipher.AES128.Internal.html#c_encrypt_ctr"><span class="hs-identifier hs-var">c_encrypt_ctr</span></a><span> </span><a href="#local-1627412039"><span class="hs-identifier hs-var">ct</span></a><span> </span><a href="#local-1627412042"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627412037"><span class="hs-identifier hs-var">iv</span></a><span> </span><a href="#local-1627412038"><span class="hs-identifier hs-var">niv</span></a><span> </span><a href="#local-1627412040"><span class="hs-identifier hs-var">pt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627412041"><span class="hs-identifier hs-var">len</span></a><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span class="hs-pragma">{-# INLINE encryptCTR #-}</span><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-identifier">decryptCTR</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627406254"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-379"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627406254"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-380"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ IV</span><span>
</span><a name="line-381"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ NEW IV</span><span>
</span><a name="line-382"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ PT</span><span>
</span><a name="line-383"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- ^ CT</span><span>
</span><a name="line-384"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>       </span><span class="hs-comment">-- ^ Length in bytes</span><span>
</span><a name="line-385"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-386"></a><a name="decryptCTR"><a href="Crypto.Cipher.AES128.Internal.html#decryptCTR"><span class="hs-identifier">decryptCTR</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#expandedKey"><span class="hs-identifier hs-var">expandedKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-1627412043"><a href="#local-1627412043"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627412044"><a href="#local-1627412044"><span class="hs-identifier">iv</span></a></a><span> </span><a name="local-1627412045"><a href="#local-1627412045"><span class="hs-identifier">niv</span></a></a><span> </span><a name="local-1627412046"><a href="#local-1627412046"><span class="hs-identifier">pt</span></a></a><span> </span><a name="local-1627412047"><a href="#local-1627412047"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1627412048"><a href="#local-1627412048"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><a href="#local-1627412043"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627412049"><a href="#local-1627412049"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-387"></a><span>    </span><a href="Crypto.Cipher.AES128.Internal.html#c_decrypt_ctr"><span class="hs-identifier hs-var">c_decrypt_ctr</span></a><span> </span><a href="#local-1627412046"><span class="hs-identifier hs-var">pt</span></a><span> </span><a href="#local-1627412049"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627412044"><span class="hs-identifier hs-var">iv</span></a><span> </span><a href="#local-1627412045"><span class="hs-identifier hs-var">niv</span></a><span> </span><a href="#local-1627412047"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627412048"><span class="hs-identifier hs-var">len</span></a><span class="hs-special">)</span><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span class="hs-identifier">encryptGCM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627406253"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-390"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627406253"><span class="hs-identifier hs-type">k</span></a><span>                   </span><span class="hs-comment">-- AES{128,192,256}</span><span>
</span><a name="line-391"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCMpc"><span class="hs-identifier hs-type">GCMpc</span></a><span>               </span><span class="hs-comment">-- Precomputed GCM Data</span><span>
</span><a name="line-392"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-comment">-- IV, len</span><span>
</span><a name="line-393"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-comment">-- AAD, len</span><span>
</span><a name="line-394"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-comment">-- PT, len</span><span>
</span><a name="line-395"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- CT  (out)</span><span>
</span><a name="line-396"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-comment">-- Tag (128 bits out)</span><span>
</span><a name="line-397"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-398"></a><a name="encryptGCM"><a href="Crypto.Cipher.AES128.Internal.html#encryptGCM"><span class="hs-identifier">encryptGCM</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#expandedKey"><span class="hs-identifier hs-var">expandedKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-1627412050"><a href="#local-1627412050"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#GCMpc"><span class="hs-identifier hs-var">GCMpc</span></a><span> </span><a name="local-1627412051"><a href="#local-1627412051"><span class="hs-identifier">g</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627412052"><a href="#local-1627412052"><span class="hs-identifier">iv</span></a></a><span> </span><a name="local-1627412053"><a href="#local-1627412053"><span class="hs-identifier">ivLen</span></a></a><span> </span><a name="local-1627412054"><a href="#local-1627412054"><span class="hs-identifier">aad</span></a></a><span> </span><a name="local-1627412055"><a href="#local-1627412055"><span class="hs-identifier">aadLen</span></a></a><span> </span><a name="local-1627412056"><a href="#local-1627412056"><span class="hs-identifier">pt</span></a></a><span> </span><a name="local-1627412057"><a href="#local-1627412057"><span class="hs-identifier">ptLen</span></a></a><span> </span><a name="local-1627412058"><a href="#local-1627412058"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1627412059"><a href="#local-1627412059"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-399"></a><span>    </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><a href="#local-1627412050"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627412060"><a href="#local-1627412060"><span class="hs-identifier">kp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-400"></a><span>      </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><a href="#local-1627412051"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627412061"><a href="#local-1627412061"><span class="hs-identifier">gp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-401"></a><span>       </span><a href="Crypto.Cipher.AES128.Internal.html#c_gcm_full_encrypt"><span class="hs-identifier hs-var">c_gcm_full_encrypt</span></a><span> </span><a href="#local-1627412060"><span class="hs-identifier hs-var">kp</span></a><span> </span><a href="#local-1627412061"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1627412052"><span class="hs-identifier hs-var">iv</span></a><span> </span><a href="#local-1627412053"><span class="hs-identifier hs-var">ivLen</span></a><span> </span><a href="#local-1627412054"><span class="hs-identifier hs-var">aad</span></a><span> </span><a href="#local-1627412055"><span class="hs-identifier hs-var">aadLen</span></a><span> </span><a href="#local-1627412056"><span class="hs-identifier hs-var">pt</span></a><span> </span><a href="#local-1627412057"><span class="hs-identifier hs-var">ptLen</span></a><span> </span><a href="#local-1627412058"><span class="hs-identifier hs-var">ct</span></a><span> </span><a href="#local-1627412059"><span class="hs-identifier hs-var">tag</span></a><span>
</span><a name="line-402"></a><span>
</span><a name="line-403"></a><span class="hs-identifier">decryptGCM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GetExpanded"><span class="hs-identifier hs-type">GetExpanded</span></a><span> </span><a href="#local-1627405814"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-404"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627405814"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-405"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Cipher.AES128.Internal.html#GCMpc"><span class="hs-identifier hs-type">GCMpc</span></a><span>
</span><a name="line-406"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-comment">-- IV, len</span><span>
</span><a name="line-407"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-comment">-- AAD, len</span><span>
</span><a name="line-408"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word32</span><span> </span><span class="hs-comment">-- CT, len</span><span>
</span><a name="line-409"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>           </span><span class="hs-comment">-- PT (out)</span><span>
</span><a name="line-410"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>           </span><span class="hs-comment">-- Tag (out)</span><span>
</span><a name="line-411"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-412"></a><a name="decryptGCM"><a href="Crypto.Cipher.AES128.Internal.html#decryptGCM"><span class="hs-identifier">decryptGCM</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#expandedKey"><span class="hs-identifier hs-var">expandedKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-1627412062"><a href="#local-1627412062"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Crypto.Cipher.AES128.Internal.html#GCMpc"><span class="hs-identifier hs-var">GCMpc</span></a><span> </span><a name="local-1627412063"><a href="#local-1627412063"><span class="hs-identifier">g</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627412064"><a href="#local-1627412064"><span class="hs-identifier">iv</span></a></a><span> </span><a name="local-1627412065"><a href="#local-1627412065"><span class="hs-identifier">ivLen</span></a></a><span> </span><a name="local-1627412066"><a href="#local-1627412066"><span class="hs-identifier">aad</span></a></a><span> </span><a name="local-1627412067"><a href="#local-1627412067"><span class="hs-identifier">aadLen</span></a></a><span> </span><a name="local-1627412068"><a href="#local-1627412068"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-1627412069"><a href="#local-1627412069"><span class="hs-identifier">ctLen</span></a></a><span> </span><a name="local-1627412070"><a href="#local-1627412070"><span class="hs-identifier">pt</span></a></a><span> </span><a name="local-1627412071"><a href="#local-1627412071"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-413"></a><span>    </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><a href="#local-1627412062"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627412072"><a href="#local-1627412072"><span class="hs-identifier">kp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-414"></a><span>      </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><a href="#local-1627412063"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627412073"><a href="#local-1627412073"><span class="hs-identifier">gp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-415"></a><span>       </span><a href="Crypto.Cipher.AES128.Internal.html#c_gcm_full_decrypt"><span class="hs-identifier hs-var">c_gcm_full_decrypt</span></a><span> </span><a href="#local-1627412072"><span class="hs-identifier hs-var">kp</span></a><span> </span><a href="#local-1627412073"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1627412064"><span class="hs-identifier hs-var">iv</span></a><span> </span><a href="#local-1627412065"><span class="hs-identifier hs-var">ivLen</span></a><span> </span><a href="#local-1627412066"><span class="hs-identifier hs-var">aad</span></a><span> </span><a href="#local-1627412067"><span class="hs-identifier hs-var">aadLen</span></a><span> </span><a href="#local-1627412068"><span class="hs-identifier hs-var">ct</span></a><span> </span><a href="#local-1627412069"><span class="hs-identifier hs-var">ctLen</span></a><span> </span><a href="#local-1627412070"><span class="hs-identifier hs-var">pt</span></a><span> </span><a href="#local-1627412071"><span class="hs-identifier hs-var">tag</span></a><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-pragma">{-# INLINE decryptCTR #-}</span><span>
</span><a name="line-418"></a></pre></body></html>