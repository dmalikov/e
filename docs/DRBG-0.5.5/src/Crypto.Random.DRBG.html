<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleInstances, TypeSynonymInstances, BangPatterns, ScopedTypeVariables #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">{-|
 Maintainer: Thomas.DuBuisson@gmail.com
 Stability: beta
 Portability: portable 

This module is the convenience interface for the DRBG (NIST standardized
number-theoretically secure random number generator).  Everything is setup
for using the &quot;crypto-api&quot; 'CryptoRandomGen' type class.

To instantiate the base types of 'HmacDRBG', 'HashDRBG', or 'CtrDRBG' just use
the 'CryptoRandomGen' primitives of 'newGen' or 'newGenIO'.

For example, to seed a new generator with the system secure random
('System.Entropy') and generate some bytes (stepping the generator along
the way) one would do:

@
    gen &lt;- newGenIO :: IO CtrDRBG
    let Right (randomBytes, newGen) = genBytes 1024 gen
@

or the same thing with your own entropy (throwing exceptions instead of dealing
with 'Either' this time):

@
    let gen = throwLeft (newGen entropy)
        (bytes,gen') = throwLeft (genBytes 1024 gen)
    in ...
@

There are several modifiers that allow you to compose generators together, producing
generators with modified security, reseed, and performance properties.  'GenXor'
will xor the random bytes of two generators.  'GenBuffered' will spark off work
to generate several megabytes of random data and keep that data buffered for
quick use.  'GenAutoReseed' will use one generator to automatically reseed
another after every 32 kilobytes of requested randoms. 

Most likely you will want to automatically reseed using system randomness
(via lazy IO).  Thus, you are left with a generator that is random, not
pseudo random but without the dangerously unsafe IO found in some other
RNGs:

@
    import Crypto.Random.DRBG hiding (genBytes)
    import Crypto.Classes.Exceptions (genBytes)

    -- An AES CTR generator that automatically reseeds.
    getCtrGen :: IO (GenAutoReseed CtrDRBG SystemEntropy)
    getCtrGen = newGenAutoReseedIO

    f = do g1 &lt;- getCtrGen
           let (bytes, g2) = getBytes 1024 g1
           g bytes g2
@

For a complex example, here is a generator that buffers several megabytes of
random values which are an Xor of AES with a SHA384 hash that are each reseeded
every 32kb with the output of a SHA512 HMAC generator (not to claim this has
any enhanced security properties, but just to show the composition can be
nested).

@
    gen &lt;- newGenIO :: IO (GenBuffered (GenAutoReseed (GenXor AesCntDRBG (HashDRBGWith SHA384)) HmacDRBG))
@

 -}</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span><span class="hs-operator">.</span><span class="hs-identifier">DRBG</span><span>
</span><a name="line-70"></a><span>        </span><span class="hs-special">(</span><span>
</span><a name="line-71"></a><span>        </span><span class="hs-comment">-- * Basic Hash-based Generators</span><span>
</span><a name="line-72"></a><span>          </span><a href="Crypto.Random.DRBG.html#HmacDRBG"><span class="hs-identifier hs-type">HmacDRBG</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#HashDRBG"><span class="hs-identifier hs-type">HashDRBG</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#CtrDRBG"><span class="hs-identifier hs-type">CtrDRBG</span></a><span>
</span><a name="line-73"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#HmacDRBGWith"><span class="hs-identifier hs-type">HmacDRBGWith</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#HashDRBGWith"><span class="hs-identifier hs-type">HashDRBGWith</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#CtrDRBGWith"><span class="hs-identifier hs-type">CtrDRBGWith</span></a><span>
</span><a name="line-74"></a><span>        </span><span class="hs-comment">-- * CryptoRandomGen Transformers</span><span>
</span><a name="line-75"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-type">GenXor</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-type">GenBuffered</span></a><span>
</span><a name="line-77"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-type">GenAutoReseed</span></a><span>
</span><a name="line-78"></a><span>        </span><span class="hs-comment">-- * AutoReseed generator construction with custom reseed interval</span><span>
</span><a name="line-79"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#newGenAutoReseed"><span class="hs-identifier hs-var">newGenAutoReseed</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#newGenAutoReseedIO"><span class="hs-identifier hs-var">newGenAutoReseedIO</span></a><span>
</span><a name="line-80"></a><span>        </span><span class="hs-comment">-- * Helper Re-exports</span><span>
</span><a name="line-81"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span><span>
</span><a name="line-82"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span>
</span><a name="line-83"></a><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Crypto.Random.DRBG.HMAC.html"><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span><span class="hs-operator">.</span><span class="hs-identifier">DRBG</span><span class="hs-operator">.</span><span class="hs-identifier">HMAC</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Crypto.Random.DRBG.Hash.html"><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span><span class="hs-operator">.</span><span class="hs-identifier">DRBG</span><span class="hs-operator">.</span><span class="hs-identifier">Hash</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">H</span><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Crypto.Random.DRBG.CTR.html"><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span><span class="hs-operator">.</span><span class="hs-identifier">DRBG</span><span class="hs-operator">.</span><span class="hs-identifier">CTR</span></a><span>  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">CTR</span><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Classes</span><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Hash</span><span class="hs-operator">.</span><span class="hs-identifier">CryptoAPI</span><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Cipher</span><span class="hs-operator">.</span><span class="hs-identifier">AES128</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AESKey128</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Entropy</span><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Tagged</span><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Parallel</span><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Error</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Either instance</span><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Random.DRBG.Hash.html#SeedLength"><span class="hs-identifier hs-type">H</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">SeedLength</span></a><span> </span><span class="hs-identifier hs-type">SHA512</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-102"></a><span>        </span><a name="local-1912643103"><a href="Crypto.Random.DRBG.Hash.html#seedlen"><span class="hs-identifier">seedlen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tagged</span><span> </span><span class="hs-number">888</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Random.DRBG.Hash.html#SeedLength"><span class="hs-identifier hs-type">H</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">SeedLength</span></a><span> </span><span class="hs-identifier hs-type">SHA384</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-105"></a><span>        </span><a name="local-1912643103"><a href="Crypto.Random.DRBG.Hash.html#seedlen"><span class="hs-identifier">seedlen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tagged</span><span>  </span><span class="hs-number">888</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Random.DRBG.Hash.html#SeedLength"><span class="hs-identifier hs-type">H</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">SeedLength</span></a><span> </span><span class="hs-identifier hs-type">SHA256</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-108"></a><span>        </span><a name="local-1912643103"><a href="Crypto.Random.DRBG.Hash.html#seedlen"><span class="hs-identifier">seedlen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tagged</span><span> </span><span class="hs-number">440</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Random.DRBG.Hash.html#SeedLength"><span class="hs-identifier hs-type">H</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">SeedLength</span></a><span> </span><span class="hs-identifier hs-type">SHA224</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-111"></a><span>        </span><a name="local-1912643103"><a href="Crypto.Random.DRBG.Hash.html#seedlen"><span class="hs-identifier">seedlen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tagged</span><span> </span><span class="hs-number">440</span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Random.DRBG.Hash.html#SeedLength"><span class="hs-identifier hs-type">H</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">SeedLength</span></a><span> </span><span class="hs-identifier hs-type">SHA1</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-114"></a><span>        </span><a name="local-1912643103"><a href="Crypto.Random.DRBG.Hash.html#seedlen"><span class="hs-identifier">seedlen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tagged</span><span> </span><span class="hs-number">440</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-comment">-- |The HMAC DRBG state (of kind * -&gt; *) allowing selection</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- of the underlying hash algorithm (SHA1, SHA224 ... SHA512)</span><span>
</span><a name="line-118"></a><span class="hs-keyword">type</span><span> </span><a name="HmacDRBGWith"><a href="Crypto.Random.DRBG.html#HmacDRBGWith"><span class="hs-identifier">HmacDRBGWith</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.HMAC.html#State"><span class="hs-identifier hs-type">M</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">State</span></a><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-comment">-- |The Hash DRBG state (of kind * -&gt; *) allowing selection</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- of the underlying hash algorithm.</span><span>
</span><a name="line-122"></a><span class="hs-keyword">type</span><span> </span><a name="HashDRBGWith"><a href="Crypto.Random.DRBG.html#HashDRBGWith"><span class="hs-identifier">HashDRBGWith</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.Hash.html#State"><span class="hs-identifier hs-type">H</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">State</span></a><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-comment">-- |The AES CTR DRBG state (of kind * -&gt; *) allowing selection</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- of the underlying cipher algorithm.</span><span>
</span><a name="line-126"></a><span class="hs-keyword">type</span><span> </span><a name="CtrDRBGWith"><a href="Crypto.Random.DRBG.html#CtrDRBGWith"><span class="hs-identifier">CtrDRBGWith</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.CTR.html#State"><span class="hs-identifier hs-type">CTR</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">State</span></a><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-comment">-- |An alias for an HMAC DRBG generator using SHA512.</span><span>
</span><a name="line-129"></a><span class="hs-keyword">type</span><span> </span><a name="HmacDRBG"><a href="Crypto.Random.DRBG.html#HmacDRBG"><span class="hs-identifier">HmacDRBG</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.HMAC.html#State"><span class="hs-identifier hs-type">M</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">State</span></a><span> </span><span class="hs-identifier hs-type">SHA512</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-comment">-- |An Alias for a Hash DRBG generator using SHA512.</span><span>
</span><a name="line-132"></a><span class="hs-comment">--</span><span>
</span><a name="line-133"></a><span class="hs-comment">-- As of 1July2014 this remains the fastest cryptographic RNG on hackage</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- that has been ran against known answer tests.</span><span>
</span><a name="line-135"></a><span class="hs-keyword">type</span><span> </span><a name="HashDRBG"><a href="Crypto.Random.DRBG.html#HashDRBG"><span class="hs-identifier">HashDRBG</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.Hash.html#State"><span class="hs-identifier hs-type">H</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">State</span></a><span> </span><span class="hs-identifier hs-type">SHA512</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">-- |The recommended generator which uses AES-128 in counter mode.</span><span>
</span><a name="line-138"></a><span class="hs-comment">--</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- This is an alias for a Counter DRBG generator using AES 128.</span><span>
</span><a name="line-140"></a><span class="hs-keyword">type</span><span> </span><a name="CtrDRBG"><a href="Crypto.Random.DRBG.html#CtrDRBG"><span class="hs-identifier">CtrDRBG</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.CTR.html#State"><span class="hs-identifier hs-type">CTR</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">State</span></a><span> </span><span class="hs-identifier hs-type">AESKey128</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-comment">-- |@newGenAutoReseed bs i@ creates a new 'GenAutoReseed' with a custom interval</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- of @i@ bytes using the provided entropy in @bs@.</span><span>
</span><a name="line-144"></a><span class="hs-comment">--</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- This is for extremely long running uses of 'CryptoRandomGen' instances</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- that can't explicitly reseed as often as a single underlying generator</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- would need (usually every 2^48 bytes).</span><span>
</span><a name="line-148"></a><span class="hs-comment">--</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- For example:</span><span>
</span><a name="line-150"></a><span class="hs-comment">--</span><span>
</span><a name="line-151"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- newGenAutoReseedIO (2^48) :: IO (Either GenError (GenAutoReseed HashDRBG HashDRBG))</span><span>
</span><a name="line-153"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-154"></a><span class="hs-comment">-- </span><span>
</span><a name="line-155"></a><span class="hs-comment">-- Will last for @2^48 * 2^41@ bytes of randomly generated data.  That's</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- 2^49 terabytes of random values (128 byte reseeds every 2^48 bytes generated).</span><span>
</span><a name="line-157"></a><span class="hs-identifier">newGenAutoReseed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435516"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435517"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">GenError</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-type">GenAutoReseed</span></a><span> </span><a href="#local-1627435516"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627435517"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-158"></a><a name="newGenAutoReseed"><a href="Crypto.Random.DRBG.html#newGenAutoReseed"><span class="hs-identifier">newGenAutoReseed</span></a></a><span> </span><a name="local-1627435518"><a href="#local-1627435518"><span class="hs-identifier">bs</span></a></a><span> </span><a name="local-1627435519"><a href="#local-1627435519"><span class="hs-identifier">rsInterval</span></a></a><span class="hs-glyph">=</span><span>
</span><a name="line-159"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627435520"><a href="#local-1627435520"><span class="hs-identifier">b1</span></a></a><span class="hs-special">,</span><a name="local-1627435521"><a href="#local-1627435521"><span class="hs-identifier">b2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435524"><span class="hs-identifier hs-var">fromRight</span></a><span> </span><a href="#local-1627435522"><span class="hs-identifier hs-var">g1</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435518"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-160"></a><span>            </span><a name="local-1627435522"><a href="#local-1627435522"><span class="hs-identifier">g1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">newGen</span><span> </span><a href="#local-1627435520"><span class="hs-identifier hs-var">b1</span></a><span>
</span><a name="line-161"></a><span>            </span><a name="local-1627435523"><a href="#local-1627435523"><span class="hs-identifier">g2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">newGen</span><span> </span><a href="#local-1627435521"><span class="hs-identifier hs-var">b2</span></a><span>
</span><a name="line-162"></a><span>            </span><a name="local-1627435524"><a href="#local-1627435524"><span class="hs-identifier">fromRight</span></a></a><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627435525"><a href="#local-1627435525"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627435525"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-163"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-1627435522"><span class="hs-identifier hs-var">g1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627435523"><span class="hs-identifier hs-var">g2</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-164"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627435526"><a href="#local-1627435526"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627435527"><a href="#local-1627435527"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a href="#local-1627435519"><span class="hs-identifier hs-var">rsInterval</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-1627435526"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627435527"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-165"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627435528"><a href="#local-1627435528"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627435528"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-166"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627435529"><a href="#local-1627435529"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627435529"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-comment">-- |@newGenAutoReseedIO i@ creates a new 'GenAutoReseed' with a custom</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- interval of @i@ bytes, using the system random number generator as a seed.</span><span>
</span><a name="line-170"></a><span class="hs-comment">--</span><span>
</span><a name="line-171"></a><span class="hs-comment">-- See 'newGenAutoReseed'.</span><span>
</span><a name="line-172"></a><span class="hs-identifier">newGenAutoReseedIO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435514"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435515"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-type">GenAutoReseed</span></a><span> </span><a href="#local-1627435514"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627435515"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><a name="newGenAutoReseedIO"><a href="Crypto.Random.DRBG.html#newGenAutoReseedIO"><span class="hs-identifier">newGenAutoReseedIO</span></a></a><span> </span><a name="local-1627435530"><a href="#local-1627435530"><span class="hs-identifier">i</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-174"></a><span>        </span><a name="local-1627435531"><a href="#local-1627435531"><span class="hs-identifier">g1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newGenIO</span><span>
</span><a name="line-175"></a><span>        </span><a name="local-1627435532"><a href="#local-1627435532"><span class="hs-identifier">g2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newGenIO</span><span>
</span><a name="line-176"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a href="#local-1627435530"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-1627435531"><span class="hs-identifier hs-var">g1</span></a><span> </span><a href="#local-1627435532"><span class="hs-identifier hs-var">g2</span></a><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="Crypto.Random.DRBG.html#HmacDRBG"><span class="hs-identifier hs-type">HmacDRBG</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-179"></a><span>        </span><a name="local-1912611128"><span class="hs-identifier">newGen</span></a><span> </span><a name="local-1627435766"><a href="#local-1627435766"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-180"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435767"><a href="#local-1627435767"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.HMAC.html#instantiate"><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">instantiate</span></a><span> </span><a href="#local-1627435766"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-181"></a><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627435766"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435767"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-182"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NotEnoughEntropy</span><span>
</span><a name="line-183"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627435767"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-184"></a><span>        </span><a name="local-1912611127"><span class="hs-identifier">genSeedLength</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tagged</span><span> </span><span class="hs-special">(</span><span class="hs-number">512</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>        </span><a name="local-1912611126"><span class="hs-identifier">genBytes</span></a><span> </span><a name="local-1627435768"><a href="#local-1627435768"><span class="hs-identifier">req</span></a></a><span> </span><a name="local-1627435769"><a href="#local-1627435769"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-186"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435770"><a href="#local-1627435770"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.HMAC.html#generate"><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span></a><span> </span><a href="#local-1627435769"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627435768"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-187"></a><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627435770"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-188"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NeedReseed</span><span>
</span><a name="line-189"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-1627435771"><a href="#local-1627435771"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-1627435772"><a href="#local-1627435772"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-1627435771"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627435772"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>        </span><a name="local-1912611123"><span class="hs-identifier">genBytesWithEntropy</span></a><span> </span><a name="local-1627435773"><a href="#local-1627435773"><span class="hs-identifier">req</span></a></a><span> </span><a name="local-1627435774"><a href="#local-1627435774"><span class="hs-identifier">ai</span></a></a><span> </span><a name="local-1627435775"><a href="#local-1627435775"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-191"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435776"><a href="#local-1627435776"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.HMAC.html#generate"><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span></a><span> </span><a href="#local-1627435775"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627435773"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><a href="#local-1627435774"><span class="hs-identifier hs-var">ai</span></a><span>
</span><a name="line-192"></a><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627435776"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-193"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NeedReseed</span><span>
</span><a name="line-194"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-1627435777"><a href="#local-1627435777"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-1627435778"><a href="#local-1627435778"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-1627435777"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627435778"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>        </span><a name="local-1912611122"><span class="hs-identifier">reseed</span></a><span> </span><a name="local-1627435779"><a href="#local-1627435779"><span class="hs-identifier">ent</span></a></a><span> </span><a name="local-1627435780"><a href="#local-1627435780"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-196"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435781"><a href="#local-1627435781"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.HMAC.html#reseed"><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">reseed</span></a><span> </span><a href="#local-1627435780"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627435779"><span class="hs-identifier hs-var">ent</span></a><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-197"></a><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627435779"><span class="hs-identifier hs-var">ent</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435781"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-198"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NotEnoughEntropy</span><span>
</span><a name="line-199"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627435781"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span>        </span><a name="local-1912611125"><span class="hs-identifier">reseedInfo</span></a><span> </span><a name="local-1627435782"><a href="#local-1627435782"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InXCalls</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">M</span><span class="hs-operator">.</span><span class="hs-identifier">counter</span><span> </span><a href="#local-1627435782"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>        </span><a name="local-1912611124"><span class="hs-identifier">reseedPeriod</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InXCalls</span><span> </span><a href="Crypto.Random.DRBG.HMAC.html#reseedInterval"><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">reseedInterval</span></a><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="Crypto.Random.DRBG.html#HashDRBG"><span class="hs-identifier hs-type">HashDRBG</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-205"></a><span>        </span><a name="local-1912611128"><span class="hs-identifier">newGen</span></a><span> </span><a name="local-1627435749"><a href="#local-1627435749"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-206"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435750"><a href="#local-1627435750"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.Hash.html#instantiate"><span class="hs-identifier hs-var">H</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">instantiate</span></a><span> </span><a href="#local-1627435749"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-207"></a><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627435749"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435750"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-208"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NotEnoughEntropy</span><span>
</span><a name="line-209"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627435750"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-210"></a><span>        </span><a name="local-1912611127"><span class="hs-identifier">genSeedLength</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tagged</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-number">512</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-211"></a><span>        </span><a name="local-1912611126"><span class="hs-identifier">genBytes</span></a><span> </span><a name="local-1627435751"><a href="#local-1627435751"><span class="hs-identifier">req</span></a></a><span> </span><a name="local-1627435752"><a href="#local-1627435752"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-212"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435753"><a href="#local-1627435753"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.Hash.html#generate"><span class="hs-identifier hs-var">H</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span></a><span> </span><a href="#local-1627435752"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627435751"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-213"></a><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627435753"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-214"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NeedReseed</span><span>
</span><a name="line-215"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-1627435754"><a href="#local-1627435754"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-1627435755"><a href="#local-1627435755"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-1627435754"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627435755"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>        </span><a name="local-1912611123"><span class="hs-identifier">genBytesWithEntropy</span></a><span> </span><a name="local-1627435756"><a href="#local-1627435756"><span class="hs-identifier">req</span></a></a><span> </span><a name="local-1627435757"><a href="#local-1627435757"><span class="hs-identifier">ai</span></a></a><span> </span><a name="local-1627435758"><a href="#local-1627435758"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-217"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435759"><a href="#local-1627435759"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.Hash.html#generate"><span class="hs-identifier hs-var">H</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span></a><span> </span><a href="#local-1627435758"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627435756"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><a href="#local-1627435757"><span class="hs-identifier hs-var">ai</span></a><span>
</span><a name="line-218"></a><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627435759"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-219"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NeedReseed</span><span>
</span><a name="line-220"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-1627435760"><a href="#local-1627435760"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-1627435761"><a href="#local-1627435761"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-1627435760"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627435761"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>        </span><a name="local-1912611122"><span class="hs-identifier">reseed</span></a><span> </span><a name="local-1627435762"><a href="#local-1627435762"><span class="hs-identifier">ent</span></a></a><span> </span><a name="local-1627435763"><a href="#local-1627435763"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-222"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435764"><a href="#local-1627435764"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.Hash.html#reseed"><span class="hs-identifier hs-var">H</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">reseed</span></a><span> </span><a href="#local-1627435763"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627435762"><span class="hs-identifier hs-var">ent</span></a><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-223"></a><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627435762"><span class="hs-identifier hs-var">ent</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435764"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-224"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NotEnoughEntropy</span><span>
</span><a name="line-225"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627435764"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-226"></a><span>        </span><a name="local-1912611125"><span class="hs-identifier">reseedInfo</span></a><span> </span><a name="local-1627435765"><a href="#local-1627435765"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InXCalls</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">H</span><span class="hs-operator">.</span><span class="hs-identifier">counter</span><span> </span><a href="#local-1627435765"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-227"></a><span>        </span><a name="local-1912611124"><span class="hs-identifier">reseedPeriod</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InXCalls</span><span> </span><a href="Crypto.Random.DRBG.Hash.html#reseedInterval"><span class="hs-identifier hs-var">H</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">reseedInterval</span></a><span>
</span><a name="line-228"></a><span>
</span><a name="line-229"></a><span class="hs-identifier">helper1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-type">GenAutoReseed</span></a><span> </span><a href="#local-1627435512"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627435513"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627435512"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-230"></a><a name="helper1"><a href="Crypto.Random.DRBG.html#helper1"><span class="hs-identifier">helper1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-identifier">helper2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-type">GenAutoReseed</span></a><span> </span><a href="#local-1627435510"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627435511"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627435511"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-233"></a><a name="helper2"><a href="Crypto.Random.DRBG.html#helper2"><span class="hs-identifier">helper2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span class="hs-comment">-- |@g :: GenAutoReseed a b@ is a generator of type a that gets</span><span>
</span><a name="line-236"></a><span class="hs-comment">-- automatically reseeded by generator b upon every 32kB generated.</span><span>
</span><a name="line-237"></a><span class="hs-comment">--</span><span>
</span><a name="line-238"></a><span class="hs-comment">-- @reseed g ent@ will reseed both the component generators by</span><span>
</span><a name="line-239"></a><span class="hs-comment">-- breaking ent up into two parts determined by the genSeedLength of each generator.</span><span>
</span><a name="line-240"></a><span class="hs-comment">--</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- @genBytes@ will generate the requested bytes with generator @a@ and reseed @a@</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- using generator @b@ if there has been 32KB of generated data since the last reseed.</span><span>
</span><a name="line-243"></a><span class="hs-comment">-- Note a request for &gt; 32KB of data will be filled in one request to generator @a@ before</span><span>
</span><a name="line-244"></a><span class="hs-comment">-- @a@ is reseeded by @b@.</span><span>
</span><a name="line-245"></a><span class="hs-comment">--</span><span>
</span><a name="line-246"></a><span class="hs-comment">-- @genBytesWithEntropy@ is lifted into the same call for generator @a@, but</span><span>
</span><a name="line-247"></a><span class="hs-comment">-- it will still reseed from generator @b@ if the limit is hit.</span><span>
</span><a name="line-248"></a><span class="hs-comment">--</span><span>
</span><a name="line-249"></a><span class="hs-comment">-- Reseed interval: If generator @a@ needs a @genSeedLength a = a'@ and generator B</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- needs reseeded every @2^b@ bytes then a @GenAutoReseed a b@ will need reseeded every</span><span>
</span><a name="line-251"></a><span class="hs-comment">-- @2^15 * (2^b / a')@ bytes.  For the common values of @a' = 128@ and @2^b = 2^48@ this</span><span>
</span><a name="line-252"></a><span class="hs-comment">-- means reseeding every 2^56 byte.  For the example numbers this translates to</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- about 200 years of continually generating random values at a rate of 10MB/s.</span><span>
</span><a name="line-254"></a><span class="hs-keyword">data</span><span> </span><a name="GenAutoReseed"><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier">GenAutoReseed</span></a></a><span> </span><a name="local-1627435310"><a href="#local-1627435310"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627435311"><a href="#local-1627435311"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GenAutoReseed"><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier">GenAutoReseed</span></a></a><span>
</span><a name="line-255"></a><span>        </span><span class="hs-special">{</span><span> </span><a name="garInterval"><a href="Crypto.Random.DRBG.html#garInterval"><span class="hs-identifier">garInterval</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-256"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="garCounter"><a href="Crypto.Random.DRBG.html#garCounter"><span class="hs-identifier">garCounter</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-257"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="garPrimeGen"><a href="Crypto.Random.DRBG.html#garPrimeGen"><span class="hs-identifier">garPrimeGen</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="#local-1627435310"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-258"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="garBackupGen"><a href="Crypto.Random.DRBG.html#garBackupGen"><span class="hs-identifier">garBackupGen</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="#local-1627435311"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-259"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-identifier">genBytesAutoReseed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435508"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435509"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-262"></a><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">ByteLength</span><span>
</span><a name="line-263"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-type">GenAutoReseed</span></a><span> </span><a href="#local-1627435508"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627435509"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-264"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">GenError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-type">GenAutoReseed</span></a><span> </span><a href="#local-1627435508"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627435509"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-265"></a><a name="genBytesAutoReseed"><a href="Crypto.Random.DRBG.html#genBytesAutoReseed"><span class="hs-identifier">genBytesAutoReseed</span></a></a><span> </span><a name="local-1627435533"><a href="#local-1627435533"><span class="hs-identifier">req</span></a></a><span> </span><a name="local-1627435534"><a href="#local-1627435534"><span class="hs-identifier">gar</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a name="local-1627435535"><a href="#local-1627435535"><span class="hs-identifier">rs</span></a></a><span> </span><a name="local-1627435536"><a href="#local-1627435536"><span class="hs-identifier">cnt</span></a></a><span> </span><a name="local-1627435537"><a href="#local-1627435537"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627435538"><a href="#local-1627435538"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-266"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435533"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435537"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-267"></a><span>       </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NeedReseed</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-268"></a><span>               </span><span class="hs-special">(</span><a name="local-1627435539"><a href="#local-1627435539"><span class="hs-identifier">a'</span></a></a><span class="hs-special">,</span><a name="local-1627435540"><a href="#local-1627435540"><span class="hs-identifier">b'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627435537"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Random.DRBG.html#reseedWith"><span class="hs-identifier hs-var">reseedWith</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627435538"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-269"></a><span>               </span><span class="hs-special">(</span><a name="local-1627435541"><a href="#local-1627435541"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435542"><a href="#local-1627435542"><span class="hs-identifier">aNew</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435533"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435539"><span class="hs-identifier hs-var">a'</span></a><span>
</span><a name="line-270"></a><span>               </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627435541"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a href="#local-1627435535"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-1627435542"><span class="hs-identifier hs-var">aNew</span></a><span> </span><a href="#local-1627435540"><span class="hs-identifier hs-var">b'</span></a><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>       </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">RequestedTooManyBytes</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-272"></a><span>         </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435543"><a href="#local-1627435543"><span class="hs-identifier">reqSmall</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><a href="#local-1627435533"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-273"></a><span>         </span><span class="hs-special">(</span><a name="local-1627435544"><a href="#local-1627435544"><span class="hs-identifier">s1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435545"><a href="#local-1627435545"><span class="hs-identifier">gar1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435543"><span class="hs-identifier hs-var">reqSmall</span></a><span> </span><a href="#local-1627435534"><span class="hs-identifier hs-var">gar</span></a><span>
</span><a name="line-274"></a><span>         </span><span class="hs-special">(</span><a name="local-1627435546"><a href="#local-1627435546"><span class="hs-identifier">s2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435547"><a href="#local-1627435547"><span class="hs-identifier">gar2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435543"><span class="hs-identifier hs-var">reqSmall</span></a><span> </span><a href="#local-1627435545"><span class="hs-identifier hs-var">gar1</span></a><span>
</span><a name="line-275"></a><span>         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-1627435533"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">append</span><span> </span><a href="#local-1627435544"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-1627435546"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1627435547"><span class="hs-identifier hs-var">gar2</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>       </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627435548"><a href="#local-1627435548"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627435548"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-277"></a><span>       </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-1627435549"><a href="#local-1627435549"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><a name="local-1627435550"><a href="#local-1627435550"><span class="hs-identifier">aNew</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-278"></a><span>         </span><a name="local-1627435553"><a href="#local-1627435553"><span class="hs-identifier">gNew</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-1627435536"><span class="hs-identifier hs-var">cnt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627435533"><span class="hs-identifier hs-var">req</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-1627435535"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-279"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-280"></a><span>                     </span><span class="hs-special">(</span><a name="local-1627435551"><a href="#local-1627435551"><span class="hs-identifier">a'</span></a></a><span class="hs-special">,</span><a name="local-1627435552"><a href="#local-1627435552"><span class="hs-identifier">b'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627435537"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Random.DRBG.html#reseedWith"><span class="hs-identifier hs-var">reseedWith</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627435538"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-281"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a href="#local-1627435535"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-1627435551"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="#local-1627435552"><span class="hs-identifier hs-var">b'</span></a><span class="hs-special">)</span><span>
</span><a name="line-282"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a href="#local-1627435535"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627435536"><span class="hs-identifier hs-var">cnt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627435533"><span class="hs-identifier hs-var">req</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435550"><span class="hs-identifier hs-var">aNew</span></a><span> </span><a href="#local-1627435538"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-283"></a><span>         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627435549"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627435553"><span class="hs-identifier hs-var">gNew</span></a><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span class="hs-identifier">reseedWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435506"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435507"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-286"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627435506"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627435507"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">GenError</span><span> </span><span class="hs-special">(</span><a href="#local-1627435506"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-1627435507"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-287"></a><a name="reseedWith"><a href="Crypto.Random.DRBG.html#reseedWith"><span class="hs-identifier">reseedWith</span></a></a><span> </span><a name="local-1627435554"><a href="#local-1627435554"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627435555"><a href="#local-1627435555"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-288"></a><span>     </span><span class="hs-special">(</span><a name="local-1627435556"><a href="#local-1627435556"><span class="hs-identifier">ent</span></a></a><span class="hs-special">,</span><a name="local-1627435557"><a href="#local-1627435557"><span class="hs-identifier">y2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435554"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435555"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-289"></a><span>     </span><a name="local-1627435558"><a href="#local-1627435558"><span class="hs-identifier">x2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">reseed</span><span> </span><a href="#local-1627435556"><span class="hs-identifier hs-var">ent</span></a><span> </span><a href="#local-1627435554"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-290"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627435558"><span class="hs-identifier hs-var">x2</span></a><span class="hs-special">,</span><a href="#local-1627435557"><span class="hs-identifier hs-var">y2</span></a><span class="hs-special">)</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-identifier">genBytesWithEntropyAutoReseed</span><span>
</span><a name="line-293"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435504"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435505"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-294"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">ByteLength</span><span>
</span><a name="line-295"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-296"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-type">GenAutoReseed</span></a><span> </span><a href="#local-1627435504"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627435505"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-297"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">GenError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-type">GenAutoReseed</span></a><span> </span><a href="#local-1627435504"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627435505"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-298"></a><a name="genBytesWithEntropyAutoReseed"><a href="Crypto.Random.DRBG.html#genBytesWithEntropyAutoReseed"><span class="hs-identifier">genBytesWithEntropyAutoReseed</span></a></a><span> </span><a name="local-1627435559"><a href="#local-1627435559"><span class="hs-identifier">req</span></a></a><span> </span><a name="local-1627435560"><a href="#local-1627435560"><span class="hs-identifier">entropy</span></a></a><span> </span><a name="local-1627435561"><a href="#local-1627435561"><span class="hs-identifier">gar</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a name="local-1627435562"><a href="#local-1627435562"><span class="hs-identifier">rs</span></a></a><span> </span><a name="local-1627435563"><a href="#local-1627435563"><span class="hs-identifier">cnt</span></a></a><span> </span><a name="local-1627435564"><a href="#local-1627435564"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627435565"><a href="#local-1627435565"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-299"></a><span>   </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">genBytesWithEntropy</span><span> </span><a href="#local-1627435559"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435560"><span class="hs-identifier hs-var">entropy</span></a><span> </span><a href="#local-1627435564"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-300"></a><span>     </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NeedReseed</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-301"></a><span>             </span><span class="hs-special">(</span><a name="local-1627435566"><a href="#local-1627435566"><span class="hs-identifier">a'</span></a></a><span class="hs-special">,</span><a name="local-1627435567"><a href="#local-1627435567"><span class="hs-identifier">b'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627435564"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Random.DRBG.html#reseedWith"><span class="hs-identifier hs-var">reseedWith</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627435565"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-302"></a><span>             </span><span class="hs-special">(</span><a name="local-1627435568"><a href="#local-1627435568"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435569"><a href="#local-1627435569"><span class="hs-identifier">aNew</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytesWithEntropy</span><span> </span><a href="#local-1627435559"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435560"><span class="hs-identifier hs-var">entropy</span></a><span> </span><a href="#local-1627435566"><span class="hs-identifier hs-var">a'</span></a><span>
</span><a name="line-303"></a><span>             </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627435568"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a href="#local-1627435562"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-1627435569"><span class="hs-identifier hs-var">aNew</span></a><span> </span><a href="#local-1627435567"><span class="hs-identifier hs-var">b'</span></a><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>     </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">RequestedTooManyBytes</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-305"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435570"><a href="#local-1627435570"><span class="hs-identifier">reqSmall</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><a href="#local-1627435559"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>       </span><span class="hs-special">(</span><a name="local-1627435571"><a href="#local-1627435571"><span class="hs-identifier">s1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435572"><a href="#local-1627435572"><span class="hs-identifier">gar1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytesWithEntropy</span><span> </span><a href="#local-1627435570"><span class="hs-identifier hs-var">reqSmall</span></a><span> </span><a href="#local-1627435560"><span class="hs-identifier hs-var">entropy</span></a><span> </span><a href="#local-1627435561"><span class="hs-identifier hs-var">gar</span></a><span>
</span><a name="line-307"></a><span>       </span><span class="hs-special">(</span><a name="local-1627435573"><a href="#local-1627435573"><span class="hs-identifier">s2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435574"><a href="#local-1627435574"><span class="hs-identifier">gar2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435570"><span class="hs-identifier hs-var">reqSmall</span></a><span> </span><a href="#local-1627435572"><span class="hs-identifier hs-var">gar1</span></a><span>
</span><a name="line-308"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-1627435559"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">append</span><span> </span><a href="#local-1627435571"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-1627435573"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1627435574"><span class="hs-identifier hs-var">gar2</span></a><span class="hs-special">)</span><span>
</span><a name="line-309"></a><span>     </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627435575"><a href="#local-1627435575"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627435575"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-310"></a><span>     </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-1627435576"><a href="#local-1627435576"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><a name="local-1627435577"><a href="#local-1627435577"><span class="hs-identifier">aNew</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-311"></a><span>       </span><a name="local-1627435580"><a href="#local-1627435580"><span class="hs-identifier">gNew</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-1627435563"><span class="hs-identifier hs-var">cnt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627435559"><span class="hs-identifier hs-var">req</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-1627435562"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-312"></a><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-313"></a><span>                   </span><span class="hs-special">(</span><a name="local-1627435578"><a href="#local-1627435578"><span class="hs-identifier">a'</span></a></a><span class="hs-special">,</span><a name="local-1627435579"><a href="#local-1627435579"><span class="hs-identifier">b'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627435564"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Random.DRBG.html#reseedWith"><span class="hs-identifier hs-var">reseedWith</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627435565"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-314"></a><span>                   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a href="#local-1627435562"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-1627435578"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="#local-1627435579"><span class="hs-identifier hs-var">b'</span></a><span class="hs-special">)</span><span>
</span><a name="line-315"></a><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a href="#local-1627435562"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627435563"><span class="hs-identifier hs-var">cnt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627435559"><span class="hs-identifier hs-var">req</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435577"><span class="hs-identifier hs-var">aNew</span></a><span> </span><a href="#local-1627435565"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-316"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627435576"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627435580"><span class="hs-identifier hs-var">gNew</span></a><span class="hs-special">)</span><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435719"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435720"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-type">GenAutoReseed</span></a><span> </span><a href="#local-1627435719"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627435720"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-319"></a><span>        </span><span class="hs-pragma">{-# SPECIALIZE instance CryptoRandomGen (GenAutoReseed HmacDRBG HmacDRBG) #-}</span><span>
</span><a name="line-320"></a><span>        </span><span class="hs-pragma">{-# SPECIALIZE instance CryptoRandomGen (GenAutoReseed HashDRBG HashDRBG) #-}</span><span>
</span><a name="line-321"></a><span>        </span><span class="hs-pragma">{-# SPECIALIZE instance CryptoRandomGen (GenAutoReseed HashDRBG HmacDRBG) #-}</span><span>
</span><a name="line-322"></a><span>        </span><span class="hs-pragma">{-# SPECIALIZE instance CryptoRandomGen (GenAutoReseed HmacDRBG HashDRBG) #-}</span><span>
</span><a name="line-323"></a><span>        </span><a name="local-1912611128"><span class="hs-identifier">newGen</span></a><span> </span><a name="local-1627435721"><a href="#local-1627435721"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#newGenAutoReseed"><span class="hs-identifier hs-var">newGenAutoReseed</span></a><span> </span><a href="#local-1627435721"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-operator hs-var">^</span><span class="hs-special">(</span><span class="hs-number">19</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-324"></a><span>        </span><a name="local-1912611121"><span class="hs-identifier">newGenIO</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#newGenAutoReseedIO"><span class="hs-identifier hs-var">newGenAutoReseedIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-operator hs-var">^</span><span class="hs-special">(</span><span class="hs-number">19</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-325"></a><span>        </span><a name="local-1912611127"><span class="hs-identifier">genSeedLength</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-326"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435722"><a href="#local-1627435722"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#helper1"><span class="hs-identifier hs-var">helper1</span></a><span> </span><a href="#local-1627435724"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-327"></a><span>               </span><a name="local-1627435723"><a href="#local-1627435723"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#helper2"><span class="hs-identifier hs-var">helper2</span></a><span> </span><a href="#local-1627435724"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-328"></a><span>               </span><a name="local-1627435724"><a href="#local-1627435724"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tagged</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435722"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435723"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-329"></a><span>           </span><span class="hs-keyword">in</span><span> </span><a href="#local-1627435724"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-330"></a><span>        </span><a name="local-1912611126"><span class="hs-identifier">genBytes</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#genBytesAutoReseed"><span class="hs-identifier hs-var">genBytesAutoReseed</span></a><span>
</span><a name="line-331"></a><span>        </span><a name="local-1912611123"><span class="hs-identifier">genBytesWithEntropy</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#genBytesWithEntropyAutoReseed"><span class="hs-identifier hs-var">genBytesWithEntropyAutoReseed</span></a><span>
</span><a name="line-332"></a><span>        </span><a name="local-1912611122"><span class="hs-identifier">reseed</span></a><span> </span><a name="local-1627435725"><a href="#local-1627435725"><span class="hs-identifier">ent</span></a></a><span> </span><a name="local-1627435726"><a href="#local-1627435726"><span class="hs-identifier">gen</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a name="local-1627435727"><a href="#local-1627435727"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627435728"><a href="#local-1627435728"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627435729"><a href="#local-1627435729"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-333"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435726"><span class="hs-identifier hs-var">gen</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627435725"><span class="hs-identifier hs-var">ent</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NotEnoughEntropy</span><span>
</span><a name="line-334"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-335"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627435730"><a href="#local-1627435730"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><a name="local-1627435731"><a href="#local-1627435731"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435728"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435725"><span class="hs-identifier hs-var">ent</span></a><span>
</span><a name="line-336"></a><span>                </span><a name="local-1627435732"><a href="#local-1627435732"><span class="hs-identifier">a'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">reseed</span><span> </span><a href="#local-1627435730"><span class="hs-identifier hs-var">e1</span></a><span> </span><a href="#local-1627435728"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-337"></a><span>                </span><a name="local-1627435733"><a href="#local-1627435733"><span class="hs-identifier">b'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627435731"><span class="hs-identifier hs-var">e2</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-338"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">reseed</span><span> </span><a href="#local-1627435731"><span class="hs-identifier hs-var">e2</span></a><span> </span><a href="#local-1627435729"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-339"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627435729"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-340"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a href="#local-1627435727"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-1627435732"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="#local-1627435733"><span class="hs-identifier hs-var">b'</span></a><span>
</span><a name="line-341"></a><span>        </span><a name="local-1912611124"><span class="hs-identifier">reseedPeriod</span></a><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a name="local-1627435734"><a href="#local-1627435734"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627435735"><a href="#local-1627435735"><span class="hs-identifier">ag</span></a></a><span> </span><a name="local-1627435736"><a href="#local-1627435736"><span class="hs-identifier">bg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-342"></a><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reseedPeriod</span><span> </span><a href="#local-1627435735"><span class="hs-identifier hs-var">ag</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">reseedPeriod</span><span> </span><a href="#local-1627435736"><span class="hs-identifier hs-var">bg</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-343"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Never</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Never</span><span>
</span><a name="line-344"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Never</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Never</span><span>
</span><a name="line-345"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NotSoon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">NotSoon</span><span>
</span><a name="line-346"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">NotSoon</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">NotSoon</span><span>
</span><a name="line-347"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">InXCalls</span><span> </span><a name="local-1627435737"><a href="#local-1627435737"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-348"></a><span>                 </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627435734"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627435737"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span>
</span><a name="line-349"></a><span>                    </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">asTypeOf</span><span class="hs-special">`</span><span> </span><a href="#local-1627435737"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-350"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">NotSoon</span><span>
</span><a name="line-351"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">InXBytes</span><span> </span><span class="hs-special">(</span><a href="#local-1627435734"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-1627435737"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-352"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">InXBytes</span><span> </span><a name="local-1627435738"><a href="#local-1627435738"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-353"></a><span>                 </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435739"><a href="#local-1627435739"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435735"><span class="hs-identifier hs-var">ag</span></a><span>
</span><a name="line-354"></a><span>                     </span><a name="local-1627435740"><a href="#local-1627435740"><span class="hs-identifier">nr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627435739"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-1627435738"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627435739"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-355"></a><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">InXBytes</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627435734"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-1627435740"><span class="hs-identifier hs-var">nr</span></a><span>
</span><a name="line-356"></a><span>        </span><a name="local-1912611125"><span class="hs-identifier">reseedInfo</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenAutoReseed"><span class="hs-identifier hs-var">GenAutoReseed</span></a><span> </span><a name="local-1627435741"><a href="#local-1627435741"><span class="hs-identifier">rs</span></a></a><span> </span><a name="local-1627435742"><a href="#local-1627435742"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627435743"><a href="#local-1627435743"><span class="hs-identifier">ag</span></a></a><span> </span><a name="local-1627435744"><a href="#local-1627435744"><span class="hs-identifier">bg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-357"></a><span>          </span><span class="hs-comment">-- Attempt to provide a lower bound on the next reseed</span><span>
</span><a name="line-358"></a><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reseedInfo</span><span> </span><a href="#local-1627435743"><span class="hs-identifier hs-var">ag</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">reseedInfo</span><span> </span><a href="#local-1627435744"><span class="hs-identifier hs-var">bg</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-359"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NotSoon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">NotSoon</span><span>
</span><a name="line-360"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">NotSoon</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">NotSoon</span><span>
</span><a name="line-361"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Never</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Never</span><span>
</span><a name="line-362"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Never</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Never</span><span>
</span><a name="line-363"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">InXBytes</span><span> </span><a name="local-1627435745"><a href="#local-1627435745"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-364"></a><span>                 </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435746"><a href="#local-1627435746"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435743"><span class="hs-identifier hs-var">ag</span></a><span>
</span><a name="line-365"></a><span>                     </span><a name="local-1627435747"><a href="#local-1627435747"><span class="hs-identifier">nr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627435746"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-1627435745"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627435746"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-366"></a><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">InXBytes</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627435741"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-1627435742"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-1627435741"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-1627435747"><span class="hs-identifier hs-var">nr</span></a><span>
</span><a name="line-367"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">InXCalls</span><span> </span><a name="local-1627435748"><a href="#local-1627435748"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><a name="line-368"></a><span>                 </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627435741"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627435748"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span>
</span><a name="line-369"></a><span>                    </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">asTypeOf</span><span class="hs-special">`</span><span> </span><a href="#local-1627435748"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-370"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">NotSoon</span><span>
</span><a name="line-371"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">InXBytes</span><span> </span><span class="hs-special">(</span><a href="#local-1627435741"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-1627435742"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-1627435741"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-1627435748"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-372"></a><span>
</span><a name="line-373"></a><span class="hs-comment">-- |@g :: GenXor a b@ generates bytes with sub-generators a and b </span><span>
</span><a name="line-374"></a><span class="hs-comment">-- and exclusive-or's the outputs to produce the resulting bytes.</span><span>
</span><a name="line-375"></a><span class="hs-keyword">data</span><span> </span><a name="GenXor"><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier">GenXor</span></a></a><span> </span><a name="local-1627435308"><a href="#local-1627435308"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627435309"><a href="#local-1627435309"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GenXor"><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier">GenXor</span></a></a><span> </span><span class="hs-glyph">!</span><a href="#local-1627435308"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">!</span><a href="#local-1627435309"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-376"></a><span>
</span><a name="line-377"></a><span class="hs-identifier">helperXor1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-type">GenXor</span></a><span> </span><a href="#local-1627435501"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627435502"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435503"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627435501"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-378"></a><a name="helperXor1"><a href="Crypto.Random.DRBG.html#helperXor1"><span class="hs-identifier">helperXor1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-379"></a><span class="hs-identifier">helperXor2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-type">GenXor</span></a><span> </span><a href="#local-1627435498"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627435499"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435500"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627435499"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-380"></a><a name="helperXor2"><a href="Crypto.Random.DRBG.html#helperXor2"><span class="hs-identifier">helperXor2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-381"></a><span>
</span><a name="line-382"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435677"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435678"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-type">GenXor</span></a><span> </span><a href="#local-1627435677"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627435678"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-383"></a><span>        </span><span class="hs-pragma">{-# SPECIALIZE instance CryptoRandomGen (GenXor HmacDRBG HmacDRBG) #-}</span><span>
</span><a name="line-384"></a><span>        </span><span class="hs-pragma">{-# SPECIALIZE instance CryptoRandomGen (GenXor HashDRBG HmacDRBG) #-}</span><span>
</span><a name="line-385"></a><span>        </span><span class="hs-pragma">{-# SPECIALIZE instance CryptoRandomGen (GenXor HmacDRBG HashDRBG) #-}</span><span>
</span><a name="line-386"></a><span>        </span><span class="hs-pragma">{-# SPECIALIZE instance CryptoRandomGen (GenXor HashDRBG HashDRBG) #-}</span><span>
</span><a name="line-387"></a><span>        </span><a name="local-1912611128"><span class="hs-identifier">newGen</span></a><span> </span><a name="local-1627435679"><a href="#local-1627435679"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-388"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435680"><a href="#local-1627435680"><span class="hs-identifier">g1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">newGen</span><span> </span><a href="#local-1627435682"><span class="hs-identifier hs-var">b1</span></a><span>
</span><a name="line-389"></a><span>                    </span><a name="local-1627435681"><a href="#local-1627435681"><span class="hs-identifier">g2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">newGen</span><span> </span><a href="#local-1627435683"><span class="hs-identifier hs-var">b2</span></a><span>
</span><a name="line-390"></a><span>                    </span><span class="hs-special">(</span><a name="local-1627435682"><a href="#local-1627435682"><span class="hs-identifier">b1</span></a></a><span class="hs-special">,</span><a name="local-1627435683"><a href="#local-1627435683"><span class="hs-identifier">b2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435684"><span class="hs-identifier hs-var">fromRight</span></a><span> </span><a href="#local-1627435680"><span class="hs-identifier hs-var">g1</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435679"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-391"></a><span>                    </span><a name="local-1627435684"><a href="#local-1627435684"><span class="hs-identifier">fromRight</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627435685"><a href="#local-1627435685"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627435685"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-392"></a><span>                </span><a name="local-1627435686"><a href="#local-1627435686"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627435680"><span class="hs-identifier hs-var">g1</span></a><span>
</span><a name="line-393"></a><span>                </span><a name="local-1627435687"><a href="#local-1627435687"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627435681"><span class="hs-identifier hs-var">g2</span></a><span>
</span><a name="line-394"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-var">GenXor</span></a><span> </span><a href="#local-1627435686"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627435687"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-395"></a><span>        </span><a name="local-1912611121"><span class="hs-identifier">newGenIO</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-396"></a><span>                </span><a name="local-1627435688"><a href="#local-1627435688"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newGenIO</span><span>
</span><a name="line-397"></a><span>                </span><a name="local-1627435689"><a href="#local-1627435689"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newGenIO</span><span>
</span><a name="line-398"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-var">GenXor</span></a><span> </span><a href="#local-1627435688"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627435689"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-399"></a><span>        </span><a name="local-1912611127"><span class="hs-identifier">genSeedLength</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-400"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435690"><a href="#local-1627435690"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#helperXor1"><span class="hs-identifier hs-var">helperXor1</span></a><span> </span><a href="#local-1627435692"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-401"></a><span>                    </span><a name="local-1627435691"><a href="#local-1627435691"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#helperXor2"><span class="hs-identifier hs-var">helperXor2</span></a><span> </span><a href="#local-1627435692"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-402"></a><span>                    </span><a name="local-1627435692"><a href="#local-1627435692"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tagged</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435690"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435691"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-403"></a><span>                </span><span class="hs-keyword">in</span><span> </span><a href="#local-1627435692"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-404"></a><span>        </span><a name="local-1912611126"><span class="hs-identifier">genBytes</span></a><span> </span><a name="local-1627435693"><a href="#local-1627435693"><span class="hs-identifier">req</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-var">GenXor</span></a><span> </span><a name="local-1627435694"><a href="#local-1627435694"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627435695"><a href="#local-1627435695"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-405"></a><span>                </span><span class="hs-special">(</span><a name="local-1627435696"><a href="#local-1627435696"><span class="hs-identifier">r1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435697"><a href="#local-1627435697"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435693"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435694"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-406"></a><span>                </span><span class="hs-special">(</span><a name="local-1627435698"><a href="#local-1627435698"><span class="hs-identifier">r2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435699"><a href="#local-1627435699"><span class="hs-identifier">b'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435693"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435695"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-407"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zwp'</span><span> </span><a href="#local-1627435696"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="#local-1627435698"><span class="hs-identifier hs-var">r2</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-var">GenXor</span></a><span> </span><a href="#local-1627435697"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="#local-1627435699"><span class="hs-identifier hs-var">b'</span></a><span class="hs-special">)</span><span>
</span><a name="line-408"></a><span>        </span><a name="local-1912611123"><span class="hs-identifier">genBytesWithEntropy</span></a><span> </span><a name="local-1627435700"><a href="#local-1627435700"><span class="hs-identifier">req</span></a></a><span> </span><a name="local-1627435701"><a href="#local-1627435701"><span class="hs-identifier">ent</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-var">GenXor</span></a><span> </span><a name="local-1627435702"><a href="#local-1627435702"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627435703"><a href="#local-1627435703"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-409"></a><span>                </span><span class="hs-special">(</span><a name="local-1627435704"><a href="#local-1627435704"><span class="hs-identifier">r1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435705"><a href="#local-1627435705"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytesWithEntropy</span><span> </span><a href="#local-1627435700"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435701"><span class="hs-identifier hs-var">ent</span></a><span> </span><a href="#local-1627435702"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-410"></a><span>                </span><span class="hs-special">(</span><a name="local-1627435706"><a href="#local-1627435706"><span class="hs-identifier">r2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435707"><a href="#local-1627435707"><span class="hs-identifier">b'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytesWithEntropy</span><span> </span><a href="#local-1627435700"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435701"><span class="hs-identifier hs-var">ent</span></a><span> </span><a href="#local-1627435703"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-411"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zwp'</span><span> </span><a href="#local-1627435704"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="#local-1627435706"><span class="hs-identifier hs-var">r2</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-var">GenXor</span></a><span> </span><a href="#local-1627435705"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="#local-1627435707"><span class="hs-identifier hs-var">b'</span></a><span class="hs-special">)</span><span>
</span><a name="line-412"></a><span>        </span><a name="local-1912611122"><span class="hs-identifier">reseed</span></a><span> </span><a name="local-1627435708"><a href="#local-1627435708"><span class="hs-identifier">ent</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-var">GenXor</span></a><span> </span><a name="local-1627435709"><a href="#local-1627435709"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627435710"><a href="#local-1627435710"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-413"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627435711"><a href="#local-1627435711"><span class="hs-identifier">b1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435712"><a href="#local-1627435712"><span class="hs-identifier">b2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435709"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435708"><span class="hs-identifier hs-var">ent</span></a><span>
</span><a name="line-414"></a><span>                </span><a name="local-1627435713"><a href="#local-1627435713"><span class="hs-identifier">a'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">reseed</span><span> </span><a href="#local-1627435711"><span class="hs-identifier hs-var">b1</span></a><span> </span><a href="#local-1627435709"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-415"></a><span>                </span><a name="local-1627435714"><a href="#local-1627435714"><span class="hs-identifier">b'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">reseed</span><span> </span><a href="#local-1627435712"><span class="hs-identifier hs-var">b2</span></a><span> </span><a href="#local-1627435710"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-416"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-var">GenXor</span></a><span> </span><a href="#local-1627435713"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="#local-1627435714"><span class="hs-identifier hs-var">b'</span></a><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>        </span><a name="local-1912611124"><span class="hs-identifier">reseedPeriod</span></a><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-var">GenXor</span></a><span> </span><a name="local-1627435715"><a href="#local-1627435715"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627435716"><a href="#local-1627435716"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">min</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reseedPeriod</span><span> </span><a href="#local-1627435715"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reseedPeriod</span><span> </span><a href="#local-1627435716"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-418"></a><span>        </span><a name="local-1912611125"><span class="hs-identifier">reseedInfo</span></a><span>   </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenXor"><span class="hs-identifier hs-var">GenXor</span></a><span> </span><a name="local-1627435717"><a href="#local-1627435717"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627435718"><a href="#local-1627435718"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">min</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reseedInfo</span><span> </span><a href="#local-1627435717"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reseedInfo</span><span> </span><a href="#local-1627435718"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span class="hs-comment">-- |@g :: GenBuffered a@ is a generator of type @a@ that attempts to</span><span>
</span><a name="line-421"></a><span class="hs-comment">-- maintain a buffer of random values size &gt;= 1MB and &lt;= 5MB at any time.</span><span>
</span><a name="line-422"></a><span class="hs-keyword">data</span><span> </span><a name="GenBuffered"><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier">GenBuffered</span></a></a><span> </span><a name="local-1627435307"><a href="#local-1627435307"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GenBuffered"><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier">GenBuffered</span></a></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GenError</span><span class="hs-special">,</span><span> </span><a href="#local-1627435307"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="#local-1627435307"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span class="hs-identifier">bufferMinDef</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bufferMaxDef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-425"></a><a name="bufferMinDef"><a href="Crypto.Random.DRBG.html#bufferMinDef"><span class="hs-identifier">bufferMinDef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-operator hs-var">^</span><span class="hs-number">20</span><span>
</span><a name="line-426"></a><a name="bufferMaxDef"><a href="Crypto.Random.DRBG.html#bufferMaxDef"><span class="hs-identifier">bufferMaxDef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-operator hs-var">^</span><span class="hs-number">22</span><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span class="hs-identifier">newGenBuffered</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435497"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">GenError</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-type">GenBuffered</span></a><span> </span><a href="#local-1627435497"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-429"></a><a name="newGenBuffered"><a href="Crypto.Random.DRBG.html#newGenBuffered"><span class="hs-identifier">newGenBuffered</span></a></a><span> </span><a name="local-1627435581"><a href="#local-1627435581"><span class="hs-identifier">min</span></a></a><span> </span><a name="local-1627435582"><a href="#local-1627435582"><span class="hs-identifier">max</span></a></a><span> </span><a name="local-1627435583"><a href="#local-1627435583"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-430"></a><span>        </span><a name="local-1627435584"><a href="#local-1627435584"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newGen</span><span> </span><a href="#local-1627435583"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-431"></a><span>        </span><span class="hs-special">(</span><a name="local-1627435585"><a href="#local-1627435585"><span class="hs-identifier">rs</span></a></a><span class="hs-special">,</span><a name="local-1627435586"><a href="#local-1627435586"><span class="hs-identifier">g'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435581"><span class="hs-identifier hs-var">min</span></a><span> </span><a href="#local-1627435584"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-432"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435587"><a href="#local-1627435587"><span class="hs-identifier">new</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#wrapErr"><span class="hs-identifier hs-var">wrapErr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435581"><span class="hs-identifier hs-var">min</span></a><span> </span><a href="#local-1627435586"><span class="hs-identifier hs-var">g'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435586"><span class="hs-identifier hs-var">g'</span></a><span>
</span><a name="line-433"></a><span>        </span><a href="#local-1627435585"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">par</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-var">GenBuffered</span></a><span> </span><a href="#local-1627435581"><span class="hs-identifier hs-var">min</span></a><span> </span><a href="#local-1627435582"><span class="hs-identifier hs-var">max</span></a><span> </span><a href="#local-1627435587"><span class="hs-identifier hs-var">new</span></a><span> </span><a href="#local-1627435585"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-434"></a><span>
</span><a name="line-435"></a><span class="hs-identifier">newGenBufferedIO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435496"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-type">GenBuffered</span></a><span> </span><a href="#local-1627435496"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-436"></a><a name="newGenBufferedIO"><a href="Crypto.Random.DRBG.html#newGenBufferedIO"><span class="hs-identifier">newGenBufferedIO</span></a></a><span> </span><a name="local-1627435588"><a href="#local-1627435588"><span class="hs-identifier">min</span></a></a><span> </span><a name="local-1627435589"><a href="#local-1627435589"><span class="hs-identifier">max</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-437"></a><span>        </span><a name="local-1627435590"><a href="#local-1627435590"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newGenIO</span><span>
</span><a name="line-438"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-glyph">!</span><a name="local-1627435591"><a href="#local-1627435591"><span class="hs-identifier">gBuf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-439"></a><span>                </span><span class="hs-special">(</span><a name="local-1627435592"><a href="#local-1627435592"><span class="hs-identifier">rs</span></a></a><span class="hs-special">,</span><a name="local-1627435593"><a href="#local-1627435593"><span class="hs-identifier">g'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435588"><span class="hs-identifier hs-var">min</span></a><span> </span><a href="#local-1627435590"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-440"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435594"><a href="#local-1627435594"><span class="hs-identifier">new</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#wrapErr"><span class="hs-identifier hs-var">wrapErr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435588"><span class="hs-identifier hs-var">min</span></a><span> </span><a href="#local-1627435593"><span class="hs-identifier hs-var">g'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435593"><span class="hs-identifier hs-var">g'</span></a><span>
</span><a name="line-441"></a><span>                </span><a href="#local-1627435592"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">par</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-var">GenBuffered</span></a><span> </span><a href="#local-1627435588"><span class="hs-identifier hs-var">min</span></a><span> </span><a href="#local-1627435589"><span class="hs-identifier hs-var">max</span></a><span> </span><a href="#local-1627435594"><span class="hs-identifier hs-var">new</span></a><span> </span><a href="#local-1627435592"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-442"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627435591"><span class="hs-identifier hs-var">gBuf</span></a><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><a href="#local-1627435622"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-type">GenBuffered</span></a><span> </span><a href="#local-1627435622"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-445"></a><span>        </span><span class="hs-pragma">{-# SPECIALIZE instance CryptoRandomGen (GenBuffered HmacDRBG) #-}</span><span>
</span><a name="line-446"></a><span>        </span><span class="hs-pragma">{-# SPECIALIZE instance CryptoRandomGen (GenBuffered HashDRBG) #-}</span><span>
</span><a name="line-447"></a><span>        </span><span class="hs-pragma">{-# SPECIALIZE instance CryptoRandomGen (GenBuffered CtrDRBG) #-}</span><span>
</span><a name="line-448"></a><span>        </span><a name="local-1912611128"><span class="hs-identifier">newGen</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#newGenBuffered"><span class="hs-identifier hs-var">newGenBuffered</span></a><span> </span><a href="Crypto.Random.DRBG.html#bufferMinDef"><span class="hs-identifier hs-var">bufferMinDef</span></a><span> </span><a href="Crypto.Random.DRBG.html#bufferMaxDef"><span class="hs-identifier hs-var">bufferMaxDef</span></a><span>
</span><a name="line-449"></a><span>        </span><a name="local-1912611121"><span class="hs-identifier">newGenIO</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#newGenBufferedIO"><span class="hs-identifier hs-var">newGenBufferedIO</span></a><span> </span><a href="Crypto.Random.DRBG.html#bufferMinDef"><span class="hs-identifier hs-var">bufferMinDef</span></a><span> </span><a href="Crypto.Random.DRBG.html#bufferMaxDef"><span class="hs-identifier hs-var">bufferMaxDef</span></a><span>
</span><a name="line-450"></a><span>        </span><a name="local-1912611127"><span class="hs-identifier">genSeedLength</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-451"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435625"><a href="#local-1627435625"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627435623"><span class="hs-identifier hs-var">help</span></a><span> </span><a href="#local-1627435626"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-452"></a><span>                    </span><a name="local-1627435626"><a href="#local-1627435626"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tagged</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">genSeedLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435625"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-453"></a><span>                </span><span class="hs-keyword">in</span><span> </span><a href="#local-1627435626"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-454"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-455"></a><span>          </span><span class="hs-identifier">help</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-type">GenBuffered</span></a><span> </span><a href="#local-1627435622"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435624"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627435622"><span class="hs-identifier hs-type">g</span></a><span>
</span><a name="line-456"></a><span>          </span><a name="local-1627435623"><a href="#local-1627435623"><span class="hs-identifier">help</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-457"></a><span>        </span><a name="local-1912611126"><span class="hs-identifier">genBytes</span></a><span> </span><a name="local-1627435627"><a href="#local-1627435627"><span class="hs-identifier">req</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-var">GenBuffered</span></a><span> </span><a name="local-1627435628"><a href="#local-1627435628"><span class="hs-identifier">min</span></a></a><span> </span><a name="local-1627435629"><a href="#local-1627435629"><span class="hs-identifier">max</span></a></a><span> </span><a name="local-1627435630"><a href="#local-1627435630"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627435631"><a href="#local-1627435631"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-458"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627435632"><span class="hs-identifier hs-var">remSize</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-1627435628"><span class="hs-identifier hs-var">min</span></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-1627435627"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435631"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-var">GenBuffered</span></a><span> </span><a href="#local-1627435628"><span class="hs-identifier hs-var">min</span></a><span> </span><a href="#local-1627435629"><span class="hs-identifier hs-var">max</span></a><span> </span><a href="#local-1627435630"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">drop</span><span> </span><a href="#local-1627435627"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435631"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-459"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627435631"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-1627435628"><span class="hs-identifier hs-var">min</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-460"></a><span>                        </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627435630"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-461"></a><span>                                </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a name="local-1627435633"><a href="#local-1627435633"><span class="hs-identifier">err</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627435633"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-462"></a><span>                                </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627435634"><a href="#local-1627435634"><span class="hs-identifier">g</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GenErrorOther</span><span> </span><span class="hs-string">&quot;Buffering generator failed to buffer properly - unknown reason&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-463"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627435627"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627435631"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-464"></a><span>                    </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627435630"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-465"></a><span>                      </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a name="local-1627435635"><a href="#local-1627435635"><span class="hs-identifier">err</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627435635"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-466"></a><span>                      </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-1627435636"><a href="#local-1627435636"><span class="hs-identifier">bo</span></a></a><span class="hs-special">,</span><a name="local-1627435637"><a href="#local-1627435637"><span class="hs-identifier">g2</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-467"></a><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435627"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435637"><span class="hs-identifier hs-var">g2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-468"></a><span>                          </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627435638"><a href="#local-1627435638"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627435638"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-469"></a><span>                          </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-1627435639"><a href="#local-1627435639"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><a name="local-1627435640"><a href="#local-1627435640"><span class="hs-identifier">g3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-470"></a><span>                            </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-1627435639"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-var">GenBuffered</span></a><span> </span><a href="#local-1627435628"><span class="hs-identifier hs-var">min</span></a><span> </span><a href="#local-1627435629"><span class="hs-identifier hs-var">max</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-1627435636"><span class="hs-identifier hs-var">bo</span></a><span class="hs-special">,</span><a href="#local-1627435640"><span class="hs-identifier hs-var">g3</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627435631"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-471"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627435632"><span class="hs-identifier hs-var">remSize</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-1627435628"><span class="hs-identifier hs-var">min</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-472"></a><span>                        </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627435630"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-473"></a><span>                                </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a name="local-1627435641"><a href="#local-1627435641"><span class="hs-identifier">err</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627435641"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-474"></a><span>                                </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-1627435642"><a href="#local-1627435642"><span class="hs-identifier">rnd</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435643"><a href="#local-1627435643"><span class="hs-identifier">gen</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-475"></a><span>                                        </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435644"><a href="#local-1627435644"><span class="hs-identifier">new</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627435642"><span class="hs-identifier hs-var">rnd</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#wrapErr"><span class="hs-identifier hs-var">wrapErr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genBytes</span><span> </span><span class="hs-special">(</span><a href="#local-1627435629"><span class="hs-identifier hs-var">max</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">(</span><a href="#local-1627435632"><span class="hs-identifier hs-var">remSize</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627435642"><span class="hs-identifier hs-var">rnd</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627435643"><span class="hs-identifier hs-var">gen</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435643"><span class="hs-identifier hs-var">gen</span></a><span>
</span><a name="line-476"></a><span>                                                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span class="hs-special">,</span><a href="#local-1627435643"><span class="hs-identifier hs-var">gen</span></a><span class="hs-special">)</span><span>
</span><a name="line-477"></a><span>                                            </span><span class="hs-special">(</span><a name="local-1627435645"><a href="#local-1627435645"><span class="hs-identifier">rs</span></a></a><span class="hs-special">,</span><a name="local-1627435646"><a href="#local-1627435646"><span class="hs-identifier">rem</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-1627435627"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435631"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-478"></a><span>                                        </span><span class="hs-keyword">in</span><span> </span><a href="Crypto.Random.DRBG.html#eval"><span class="hs-identifier hs-var">eval</span></a><span> </span><a href="#local-1627435644"><span class="hs-identifier hs-var">new</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">par</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-1627435645"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-var">GenBuffered</span></a><span> </span><a href="#local-1627435628"><span class="hs-identifier hs-var">min</span></a><span> </span><a href="#local-1627435629"><span class="hs-identifier hs-var">max</span></a><span> </span><a href="#local-1627435644"><span class="hs-identifier hs-var">new</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">append</span><span> </span><a href="#local-1627435646"><span class="hs-identifier hs-var">rem</span></a><span> </span><a href="#local-1627435642"><span class="hs-identifier hs-var">rnd</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">GenErrorOther</span><span> </span><span class="hs-string">&quot;Buffering generator hit an impossible case.  Please inform the Haskell crypto-api maintainer&quot;</span><span>
</span><a name="line-480"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-481"></a><span>          </span><a name="local-1627435632"><a href="#local-1627435632"><span class="hs-identifier">remSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627435631"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-1627435627"><span class="hs-identifier hs-var">req</span></a><span>
</span><a name="line-482"></a><span>        </span><a name="local-1912611123"><span class="hs-identifier">genBytesWithEntropy</span></a><span> </span><a name="local-1627435647"><a href="#local-1627435647"><span class="hs-identifier">req</span></a></a><span> </span><a name="local-1627435648"><a href="#local-1627435648"><span class="hs-identifier">ent</span></a></a><span> </span><a name="local-1627435649"><a href="#local-1627435649"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reseed</span><span> </span><a href="#local-1627435648"><span class="hs-identifier hs-var">ent</span></a><span> </span><a href="#local-1627435649"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><a name="local-1627435650"><a href="#local-1627435650"><span class="hs-identifier">gen</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">genBytes</span><span> </span><a href="#local-1627435647"><span class="hs-identifier hs-var">req</span></a><span> </span><a href="#local-1627435650"><span class="hs-identifier hs-var">gen</span></a><span>
</span><a name="line-483"></a><span>        </span><a name="local-1912611122"><span class="hs-identifier">reseed</span></a><span> </span><a name="local-1627435651"><a href="#local-1627435651"><span class="hs-identifier">ent</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-var">GenBuffered</span></a><span> </span><a name="local-1627435652"><a href="#local-1627435652"><span class="hs-identifier">min</span></a></a><span> </span><a name="local-1627435653"><a href="#local-1627435653"><span class="hs-identifier">max</span></a></a><span> </span><a name="local-1627435654"><a href="#local-1627435654"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627435655"><a href="#local-1627435655"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-484"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627435656"><a href="#local-1627435656"><span class="hs-identifier">rs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435657"><a href="#local-1627435657"><span class="hs-identifier">g'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-485"></a><span>                      </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627435654"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-486"></a><span>                        </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-1627435658"><a href="#local-1627435658"><span class="hs-identifier">g'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span class="hs-special">,</span><span> </span><a href="#local-1627435658"><span class="hs-identifier hs-var">g'</span></a><span class="hs-special">)</span><span>
</span><a name="line-487"></a><span>                        </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-1627435659"><a href="#local-1627435659"><span class="hs-identifier">rs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627435660"><a href="#local-1627435660"><span class="hs-identifier">g'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627435659"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627435660"><span class="hs-identifier hs-var">g'</span></a><span class="hs-special">)</span><span>
</span><a name="line-488"></a><span>                </span><a name="local-1627435661"><a href="#local-1627435661"><span class="hs-identifier">g''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">reseed</span><span> </span><a href="#local-1627435651"><span class="hs-identifier hs-var">ent</span></a><span> </span><a href="#local-1627435657"><span class="hs-identifier hs-var">g'</span></a><span>
</span><a name="line-489"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435662"><a href="#local-1627435662"><span class="hs-identifier">new</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.DRBG.html#wrapErr"><span class="hs-identifier hs-var">wrapErr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genBytes</span><span> </span><span class="hs-special">(</span><a href="#local-1627435652"><span class="hs-identifier hs-var">min</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627435663"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435661"><span class="hs-identifier hs-var">g''</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435661"><span class="hs-identifier hs-var">g''</span></a><span>
</span><a name="line-490"></a><span>                    </span><a name="local-1627435663"><a href="#local-1627435663"><span class="hs-identifier">bs'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-1627435653"><span class="hs-identifier hs-var">max</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">append</span><span> </span><a href="#local-1627435655"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-1627435656"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-491"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-var">GenBuffered</span></a><span> </span><a href="#local-1627435652"><span class="hs-identifier hs-var">min</span></a><span> </span><a href="#local-1627435653"><span class="hs-identifier hs-var">max</span></a><span> </span><a href="#local-1627435662"><span class="hs-identifier hs-var">new</span></a><span> </span><a href="#local-1627435663"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-492"></a><span>        </span><a name="local-1912611124"><span class="hs-identifier">reseedPeriod</span></a><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-var">GenBuffered</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627435664"><a href="#local-1627435664"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reseedPeriod</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627435664"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-493"></a><span>        </span><a name="local-1912611125"><span class="hs-identifier">reseedInfo</span></a><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#GenBuffered"><span class="hs-identifier hs-var">GenBuffered</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627435676"><a href="#local-1627435676"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reseedInfo</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627435676"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-494"></a><span>
</span><a name="line-495"></a><span class="hs-identifier">wrapErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-1627435493"><span class="hs-identifier hs-type">x</span></a><span> </span><a href="#local-1627435494"><span class="hs-identifier hs-type">y</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627435495"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><a href="#local-1627435493"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">,</span><a href="#local-1627435495"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627435494"><span class="hs-identifier hs-type">y</span></a><span>
</span><a name="line-496"></a><a name="wrapErr"><a href="Crypto.Random.DRBG.html#wrapErr"><span class="hs-identifier">wrapErr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627435595"><a href="#local-1627435595"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627435596"><a href="#local-1627435596"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="#local-1627435595"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-1627435596"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-497"></a><span class="hs-identifier">wrapErr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627435597"><a href="#local-1627435597"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627435597"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-498"></a><span>
</span><a name="line-499"></a><span class="hs-comment">-- |Force evaluation for use by GenBuffered.</span><span>
</span><a name="line-500"></a><span class="hs-identifier">eval</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-1627435491"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="#local-1627435492"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-1627435491"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="#local-1627435492"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-501"></a><a name="eval"><a href="Crypto.Random.DRBG.html#eval"><span class="hs-identifier">eval</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627435598"><a href="#local-1627435598"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627435598"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-502"></a><span class="hs-identifier">eval</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-1627435599"><a href="#local-1627435599"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><a name="local-1627435600"><a href="#local-1627435600"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627435600"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-1627435599"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-1627435599"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627435600"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-503"></a><span>
</span><a name="line-504"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">BlockCipher</span><span> </span><a href="#local-1627435601"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">CryptoRandomGen</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#CtrDRBGWith"><span class="hs-identifier hs-type">CtrDRBGWith</span></a><span> </span><a href="#local-1627435601"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-505"></a><span>  </span><a name="local-1912611128"><span class="hs-identifier">newGen</span></a><span> </span><a name="local-1627435602"><a href="#local-1627435602"><span class="hs-identifier">bytes</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-506"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="Crypto.Random.DRBG.CTR.html#instantiate"><span class="hs-identifier hs-var">CTR</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">instantiate</span></a><span> </span><a href="#local-1627435602"><span class="hs-identifier hs-var">bytes</span></a><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-507"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NotEnoughEntropy</span><span>
</span><a name="line-508"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627435603"><a href="#local-1627435603"><span class="hs-identifier">st</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627435603"><span class="hs-identifier hs-var">st</span></a><span>
</span><a name="line-509"></a><span>
</span><a name="line-510"></a><span>  </span><a name="local-1912611121"><span class="hs-identifier">newGenIO</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-511"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435604"><a href="#local-1627435604"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627435601"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-comment">-- Types weren't unifying with proxy, bug?</span><span>
</span><a name="line-512"></a><span>          </span><a name="local-1627435605"><a href="#local-1627435605"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">keyLength</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435604"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">blockSize</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">for</span><span class="hs-special">`</span><span> </span><a href="#local-1627435604"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-513"></a><span>          </span><a name="local-1627435606"><a href="#local-1627435606"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-string">&quot;Unable to generate enough entropy to instantiate CTR DRBG&quot;</span><span>
</span><a name="line-514"></a><span>      </span><a name="local-1627435607"><a href="#local-1627435607"><span class="hs-identifier">kd</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getEntropy</span><span> </span><span class="hs-special">(</span><a href="#local-1627435605"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-515"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="Crypto.Random.DRBG.CTR.html#instantiate"><span class="hs-identifier hs-var">CTR</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">instantiate</span></a><span> </span><a href="#local-1627435607"><span class="hs-identifier hs-var">kd</span></a><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-516"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><a href="#local-1627435606"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-517"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627435608"><a href="#local-1627435608"><span class="hs-identifier">st</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627435608"><span class="hs-identifier hs-var">st</span></a><span>
</span><a name="line-518"></a><span>
</span><a name="line-519"></a><span>  </span><a name="local-1912611127"><span class="hs-identifier">genSeedLength</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-520"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">rt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-1627435601"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-1627435601"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.html#CtrDRBGWith"><span class="hs-identifier hs-type">CtrDRBGWith</span></a><span> </span><a href="#local-1627435601"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-521"></a><span>            </span><a name="local-1627435609"><a href="#local-1627435609"><span class="hs-identifier">rt</span></a></a><span> </span><a name="local-1627435610"><a href="#local-1627435610"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627435611"><a href="#local-1627435611"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tagged</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span>
</span><a name="line-522"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627435612"><a href="#local-1627435612"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unTagged</span><span> </span><a href="#local-1627435610"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-523"></a><span>                    </span><a name="local-1627435613"><a href="#local-1627435613"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unTagged</span><span> </span><a href="#local-1627435611"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-524"></a><span>                </span><span class="hs-keyword">in</span><span> </span><a href="#local-1627435612"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-1627435613"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-525"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="#local-1627435609"><span class="hs-identifier hs-var">rt</span></a><span> </span><span class="hs-identifier hs-var">keyLengthBytes</span><span> </span><span class="hs-identifier hs-var">blockSizeBytes</span><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span>  </span><span class="hs-comment">-- Generates req bytes (even if that is over the 2^16 bytes allowed by</span><span>
</span><a name="line-528"></a><span>  </span><span class="hs-comment">-- the NIST standard!)</span><span>
</span><a name="line-529"></a><span>  </span><a name="local-1912611126"><span class="hs-identifier">genBytes</span></a><span> </span><a name="local-1627435614"><a href="#local-1627435614"><span class="hs-identifier">req</span></a></a><span> </span><a name="local-1627435615"><a href="#local-1627435615"><span class="hs-identifier">st</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-530"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="Crypto.Random.DRBG.CTR.html#generate"><span class="hs-identifier hs-var">CTR</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span></a><span> </span><a href="#local-1627435615"><span class="hs-identifier hs-var">st</span></a><span> </span><a href="#local-1627435614"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-531"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NeedReseed</span><span>
</span><a name="line-532"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-1627435616"><a href="#local-1627435616"><span class="hs-identifier">bs</span></a></a><span class="hs-special">,</span><a name="local-1627435617"><a href="#local-1627435617"><span class="hs-identifier">new</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-1627435616"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><a href="#local-1627435617"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">)</span><span>
</span><a name="line-533"></a><span>
</span><a name="line-534"></a><span>  </span><a name="local-1912611122"><span class="hs-identifier">reseed</span></a><span> </span><a name="local-1627435618"><a href="#local-1627435618"><span class="hs-identifier">ent</span></a></a><span> </span><a name="local-1627435619"><a href="#local-1627435619"><span class="hs-identifier">st</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-535"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Crypto.Random.DRBG.CTR.html#reseed"><span class="hs-identifier hs-var">CTR</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">reseed</span></a><span> </span><a href="#local-1627435619"><span class="hs-identifier hs-var">st</span></a><span> </span><a href="#local-1627435618"><span class="hs-identifier hs-var">ent</span></a><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-536"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier hs-var">NeedReseed</span><span>
</span><a name="line-537"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627435620"><a href="#local-1627435620"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627435620"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-538"></a><span>
</span><a name="line-539"></a><span>  </span><a name="local-1912611124"><span class="hs-identifier">reseedPeriod</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InXCalls</span><span> </span><a href="Crypto.Random.DRBG.CTR.html#reseedInterval"><span class="hs-identifier hs-var">CTR</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">reseedInterval</span></a><span>
</span><a name="line-540"></a><span>
</span><a name="line-541"></a><span>  </span><a name="local-1912611125"><span class="hs-identifier">reseedInfo</span></a><span> </span><a name="local-1627435621"><a href="#local-1627435621"><span class="hs-identifier">st</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InXCalls</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.DRBG.CTR.html#reseedInterval"><span class="hs-identifier hs-var">CTR</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">reseedInterval</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="Crypto.Random.DRBG.CTR.html#getCounter"><span class="hs-identifier hs-var">CTR</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getCounter</span></a><span> </span><a href="#local-1627435621"><span class="hs-identifier hs-var">st</span></a><span class="hs-special">)</span><span>
</span><a name="line-542"></a></pre></body></html>