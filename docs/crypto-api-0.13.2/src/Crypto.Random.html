<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleInstances, TypeSynonymInstances, DeriveDataTypeable, CPP,
             BangPatterns #-}</span><span>
</span><a name="line-3"></a><span class="hs-comment">{-|
 Maintainer: Thomas.DuBuisson@gmail.com
 Stability: beta
 Portability: portable 


 This module is for instantiating cryptographicly strong
determinitic random bit generators (DRBGs, aka PRNGs) For the simple
use case of using the system random number generator
('System.Entropy') to seed the DRBG:

@   g &lt;- newGenIO
@

 Users needing to provide their own entropy can call 'newGen' directly
 
@    entropy &lt;- getEntropy nrBytes
    let generator = newGen entropy
@

-}</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span><span>
</span><a name="line-26"></a><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-comment">-- * Basic Interface</span><span>
</span><a name="line-27"></a><span>         </span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Crypto.Random.html#ReseedInfo"><span class="hs-identifier hs-type">ReseedInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span>         </span><span class="hs-comment">-- * Helper functions and expanded interface</span><span>
</span><a name="line-31"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Crypto.Random.html#splitGen"><span class="hs-identifier hs-var">splitGen</span></a><span>
</span><a name="line-32"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Crypto.Util.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a><span>
</span><a name="line-33"></a><span>         </span><span class="hs-comment">-- * Instances</span><span>
</span><a name="line-34"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Crypto.Random.html#SystemRandom"><span class="hs-identifier hs-type">SystemRandom</span></a><span>
</span><a name="line-35"></a><span>       </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="Crypto.Types.html"><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="Crypto.Util.html"><span class="hs-identifier">Crypto</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bits</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">xor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">setBit</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.&amp;.</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Data</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl'</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Tagged</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Entropy</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Unsafe</span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafeInterleaveIO</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">ForeignPtr</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">FP</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-cpp">#if MIN_VERSION_tagged(0,2,0)</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Proxy</span><span>
</span><a name="line-55"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-comment">-- |Generator failures should always return the appropriate GenError.</span><span>
</span><a name="line-58"></a><span class="hs-comment">-- Note 'GenError' in an instance of exception but wether or not an</span><span>
</span><a name="line-59"></a><span class="hs-comment">-- exception is thrown depends on if the selected generator (read:</span><span>
</span><a name="line-60"></a><span class="hs-comment">-- if you don't want execptions from code that uses 'throw' then</span><span>
</span><a name="line-61"></a><span class="hs-comment">-- pass in a generator that never has an error for the used functions)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">data</span><span> </span><a name="GenError"><a href="Crypto.Random.html#GenError"><span class="hs-identifier">GenError</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-63"></a><span>          </span><a name="GenErrorOther"><a href="Crypto.Random.html#GenErrorOther"><span class="hs-identifier">GenErrorOther</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>  </span><span class="hs-comment">-- ^ Misc</span><span>
</span><a name="line-64"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a name="RequestedTooManyBytes"><a href="Crypto.Random.html#RequestedTooManyBytes"><span class="hs-identifier">RequestedTooManyBytes</span></a></a><span> </span><span class="hs-comment">-- ^ Requested more bytes than a</span><span>
</span><a name="line-65"></a><span>                                </span><span class="hs-comment">-- single pass can generate (The</span><span>
</span><a name="line-66"></a><span>                                </span><span class="hs-comment">-- maximum request is generator</span><span>
</span><a name="line-67"></a><span>                                </span><span class="hs-comment">-- dependent)</span><span>
</span><a name="line-68"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a name="RangeInvalid"><a href="Crypto.Random.html#RangeInvalid"><span class="hs-identifier">RangeInvalid</span></a></a><span>          </span><span class="hs-comment">-- ^ When using @genInteger g (l,h)@</span><span>
</span><a name="line-69"></a><span>                                </span><span class="hs-comment">-- and @logBase 2 (h - l) &gt; (maxBound</span><span>
</span><a name="line-70"></a><span>                                </span><span class="hs-comment">-- :: Int)@.</span><span>
</span><a name="line-71"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a name="NeedReseed"><a href="Crypto.Random.html#NeedReseed"><span class="hs-identifier">NeedReseed</span></a></a><span>            </span><span class="hs-comment">-- ^ Some generators cease operation</span><span>
</span><a name="line-72"></a><span>                                </span><span class="hs-comment">-- after too high a count without a</span><span>
</span><a name="line-73"></a><span>                                </span><span class="hs-comment">-- reseed (ex: NIST SP 800-90)</span><span>
</span><a name="line-74"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a name="NotEnoughEntropy"><a href="Crypto.Random.html#NotEnoughEntropy"><span class="hs-identifier">NotEnoughEntropy</span></a></a><span>      </span><span class="hs-comment">-- ^ For instantiating new generators</span><span>
</span><a name="line-75"></a><span>                                </span><span class="hs-comment">-- (or reseeding)</span><span>
</span><a name="line-76"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a name="NeedsInfiniteSeed"><a href="Crypto.Random.html#NeedsInfiniteSeed"><span class="hs-identifier">NeedsInfiniteSeed</span></a></a><span>     </span><span class="hs-comment">-- ^ This generator can not be</span><span>
</span><a name="line-77"></a><span>                                </span><span class="hs-comment">-- instantiated or reseeded with a</span><span>
</span><a name="line-78"></a><span>                                </span><span class="hs-comment">-- finite seed (ex: 'SystemRandom')</span><span>
</span><a name="line-79"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Read</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Data</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-keyword">data</span><span> </span><a name="ReseedInfo"><a href="Crypto.Random.html#ReseedInfo"><span class="hs-identifier">ReseedInfo</span></a></a><span>
</span><a name="line-82"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="InXBytes"><a href="Crypto.Random.html#InXBytes"><span class="hs-identifier">InXBytes</span></a></a><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word64</span><span>   </span><span class="hs-comment">-- ^ Generator needs reseeded in X bytes</span><span>
</span><a name="line-83"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="InXCalls"><a href="Crypto.Random.html#InXCalls"><span class="hs-identifier">InXCalls</span></a></a><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Word64</span><span>   </span><span class="hs-comment">-- ^ Generator needs reseeded in X calls</span><span>
</span><a name="line-84"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="NotSoon"><a href="Crypto.Random.html#NotSoon"><span class="hs-identifier">NotSoon</span></a></a><span>                           </span><span class="hs-comment">-- ^ The bound is over 2^64 bytes or calls</span><span>
</span><a name="line-85"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Never"><a href="Crypto.Random.html#Never"><span class="hs-identifier">Never</span></a></a><span>                             </span><span class="hs-comment">-- ^ This generator never reseeds (ex: 'SystemRandom')</span><span>
</span><a name="line-86"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Read</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Data</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Exception</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-comment">-- |A class of random bit generators that allows for the possibility</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- of failure, reseeding, providing entropy at the same time as</span><span>
</span><a name="line-92"></a><span class="hs-comment">-- requesting bytes</span><span>
</span><a name="line-93"></a><span class="hs-comment">--</span><span>
</span><a name="line-94"></a><span class="hs-comment">-- Minimum complete definition: `newGen`, `genSeedLength`, `genBytes`,</span><span>
</span><a name="line-95"></a><span class="hs-comment">-- `reseed`, `reseedInfo`, `reseedPeriod`.</span><span>
</span><a name="line-96"></a><span class="hs-keyword">class</span><span> </span><a name="CryptoRandomGen"><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier">CryptoRandomGen</span></a></a><span> </span><a name="local-1627441987"><a href="#local-1627441987"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-97"></a><span>        </span><span class="hs-comment">-- |Instantiate a new random bit generator.  The provided</span><span>
</span><a name="line-98"></a><span>        </span><span class="hs-comment">-- bytestring should be of length &gt;= genSeedLength.  If the</span><span>
</span><a name="line-99"></a><span>        </span><span class="hs-comment">-- bytestring is shorter then the call may fail (suggested</span><span>
</span><a name="line-100"></a><span>        </span><span class="hs-comment">-- error: `NotEnoughEntropy`).  If the bytestring is of</span><span>
</span><a name="line-101"></a><span>        </span><span class="hs-comment">-- sufficent length the call should always succeed.</span><span>
</span><a name="line-102"></a><span>        </span><span class="hs-identifier">newGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><a href="#local-1627441987"><span class="hs-identifier hs-type">g</span></a><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span>        </span><span class="hs-comment">-- |Length of input entropy necessary to instantiate or reseed</span><span>
</span><a name="line-105"></a><span>        </span><span class="hs-comment">-- a generator</span><span>
</span><a name="line-106"></a><span>        </span><span class="hs-identifier">genSeedLength</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Tagged</span><span> </span><a href="#local-1627441987"><span class="hs-identifier hs-type">g</span></a><span> </span><a href="Crypto.Types.html#ByteLength"><span class="hs-identifier hs-type">ByteLength</span></a><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span>        </span><span class="hs-comment">-- | @genBytes len g@ generates a random ByteString of length</span><span>
</span><a name="line-109"></a><span>        </span><span class="hs-comment">-- @len@ and new generator.  The &quot;MonadCryptoRandom&quot; package</span><span>
</span><a name="line-110"></a><span>        </span><span class="hs-comment">-- has routines useful for converting the ByteString to</span><span>
</span><a name="line-111"></a><span>        </span><span class="hs-comment">-- commonly needed values (but &quot;cereal&quot; or other</span><span>
</span><a name="line-112"></a><span>        </span><span class="hs-comment">-- deserialization libraries would also work).</span><span>
</span><a name="line-113"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-114"></a><span>        </span><span class="hs-comment">-- This routine can fail if the generator has gone too long</span><span>
</span><a name="line-115"></a><span>        </span><span class="hs-comment">-- without a reseed (usually this is in the ball-park of 2^48</span><span>
</span><a name="line-116"></a><span>        </span><span class="hs-comment">-- requests).  Suggested error in this cases is `NeedReseed`</span><span>
</span><a name="line-117"></a><span>        </span><span class="hs-identifier">genBytes</span><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Types.html#ByteLength"><span class="hs-identifier hs-type">ByteLength</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627441987"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="#local-1627441987"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span>        </span><span class="hs-comment">-- | Indicates how soon a reseed is needed</span><span>
</span><a name="line-120"></a><span>        </span><span class="hs-identifier">reseedInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627441987"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Random.html#ReseedInfo"><span class="hs-identifier hs-type">ReseedInfo</span></a><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>        </span><span class="hs-comment">-- | Indicates the period between reseeds (constant for most generators).</span><span>
</span><a name="line-123"></a><span>        </span><span class="hs-identifier">reseedPeriod</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627441987"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Crypto.Random.html#ReseedInfo"><span class="hs-identifier hs-type">ReseedInfo</span></a><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span>        </span><span class="hs-comment">-- |@genBytesWithEntropy g i entropy@ generates @i@ random</span><span>
</span><a name="line-126"></a><span>        </span><span class="hs-comment">-- bytes and use the additional input @entropy@ in the</span><span>
</span><a name="line-127"></a><span>        </span><span class="hs-comment">-- generation of the requested data to increase the confidence</span><span>
</span><a name="line-128"></a><span>        </span><span class="hs-comment">-- our generated data is a secure random stream.</span><span>
</span><a name="line-129"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-130"></a><span>        </span><span class="hs-comment">-- Some generators use @entropy@ to perturb the state of the</span><span>
</span><a name="line-131"></a><span>        </span><span class="hs-comment">-- generator, meaning:</span><span>
</span><a name="line-132"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-133"></a><span>        </span><span class="hs-comment">-- @</span><span>
</span><a name="line-134"></a><span>        </span><span class="hs-comment">--     (_,g2') &lt;- genBytesWithEntropy len g1 ent</span><span>
</span><a name="line-135"></a><span>        </span><span class="hs-comment">--     (_,g2 ) &lt;- genBytes len g1</span><span>
</span><a name="line-136"></a><span>        </span><span class="hs-comment">--     g2 /= g2'</span><span>
</span><a name="line-137"></a><span>        </span><span class="hs-comment">-- @</span><span>
</span><a name="line-138"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-139"></a><span>        </span><span class="hs-comment">-- But this is not required.</span><span>
</span><a name="line-140"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-141"></a><span>        </span><span class="hs-comment">-- Default:</span><span>
</span><a name="line-142"></a><span>        </span><span class="hs-comment">-- </span><span>
</span><a name="line-143"></a><span>        </span><span class="hs-comment">-- @</span><span>
</span><a name="line-144"></a><span>        </span><span class="hs-comment">--     genBytesWithEntropy g bytes entropy = xor entropy (genBytes g bytes)</span><span>
</span><a name="line-145"></a><span>        </span><span class="hs-comment">-- @</span><span>
</span><a name="line-146"></a><span>        </span><span class="hs-identifier">genBytesWithEntropy</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Types.html#ByteLength"><span class="hs-identifier hs-type">ByteLength</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627441987"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><a href="#local-1627441987"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>        </span><a name="local-1912654641"><a href="Crypto.Random.html#genBytesWithEntropy"><span class="hs-identifier">genBytesWithEntropy</span></a></a><span> </span><a name="local-1627441988"><a href="#local-1627441988"><span class="hs-identifier">len</span></a></a><span> </span><a name="local-1627441989"><a href="#local-1627441989"><span class="hs-identifier">entropy</span></a></a><span> </span><a name="local-1627441990"><a href="#local-1627441990"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-148"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627441991"><a href="#local-1627441991"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.html#genBytes"><span class="hs-identifier hs-var">genBytes</span></a><span> </span><a href="#local-1627441988"><span class="hs-identifier hs-var">len</span></a><span> </span><a href="#local-1627441990"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-149"></a><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627441991"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-150"></a><span>                        </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627441992"><a href="#local-1627441992"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627441992"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-151"></a><span>                        </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-1627441993"><a href="#local-1627441993"><span class="hs-identifier">bs</span></a></a><span class="hs-special">,</span><a name="local-1627441994"><a href="#local-1627441994"><span class="hs-identifier">g'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-152"></a><span>                                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627441995"><a href="#local-1627441995"><span class="hs-identifier">entropy'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">append</span><span> </span><a href="#local-1627441989"><span class="hs-identifier hs-var">entropy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><a href="#local-1627441988"><span class="hs-identifier hs-var">len</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627441989"><span class="hs-identifier hs-var">entropy</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-153"></a><span>                                </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="Crypto.Util.html#zwp%27"><span class="hs-identifier hs-var">zwp'</span></a><span> </span><a href="#local-1627441995"><span class="hs-identifier hs-var">entropy'</span></a><span> </span><a href="#local-1627441993"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627441994"><span class="hs-identifier hs-var">g'</span></a><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span>        </span><span class="hs-comment">-- |If the generator has produced too many random bytes on its</span><span>
</span><a name="line-156"></a><span>        </span><span class="hs-comment">-- existing seed it will return `NeedReseed`.  In that case,</span><span>
</span><a name="line-157"></a><span>        </span><span class="hs-comment">-- reseed the generator using this function and a new</span><span>
</span><a name="line-158"></a><span>        </span><span class="hs-comment">-- high-entropy seed of length &gt;= `genSeedLength`.  Using</span><span>
</span><a name="line-159"></a><span>        </span><span class="hs-comment">-- bytestrings that are too short can result in an error</span><span>
</span><a name="line-160"></a><span>        </span><span class="hs-comment">-- (`NotEnoughEntropy`).</span><span>
</span><a name="line-161"></a><span>        </span><span class="hs-identifier">reseed</span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">B</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627441987"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><a href="#local-1627441987"><span class="hs-identifier hs-type">g</span></a><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span>        </span><span class="hs-comment">-- |By default this uses &quot;System.Entropy&quot; to obtain</span><span>
</span><a name="line-164"></a><span>        </span><span class="hs-comment">-- entropy for `newGen`.</span><span>
</span><a name="line-165"></a><span>        </span><span class="hs-identifier">newGenIO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1627441987"><span class="hs-identifier hs-type">g</span></a><span>
</span><a name="line-166"></a><span>        </span><a name="local-1912654643"><a href="Crypto.Random.html#newGenIO"><span class="hs-identifier">newGenIO</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627441996"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-167"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-168"></a><span>          </span><a name="local-1627441996"><a href="#local-1627441996"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-number">1000</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">throw</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Crypto.Random.html#GenErrorOther"><span class="hs-identifier hs-var">GenErrorOther</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span>
</span><a name="line-169"></a><span>                          </span><span class="hs-string">&quot;The generator instance requested by&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-170"></a><span>                          </span><span class="hs-string">&quot;newGenIO never instantiates (1000 tries). &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-171"></a><span>                          </span><span class="hs-string">&quot;It must be broken.&quot;</span><span>
</span><a name="line-172"></a><span>          </span><span class="hs-identifier">go</span><span> </span><a name="local-1627441997"><a href="#local-1627441997"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-173"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-1627441998"><a href="#local-1627441998"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span>
</span><a name="line-174"></a><span>                    </span><span class="hs-identifier">getTypedGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="#local-1627442000"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-1627442000"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><a href="#local-1627442000"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span>                    </span><a name="local-1627441999"><a href="#local-1627441999"><span class="hs-identifier">getTypedGen</span></a></a><span> </span><a name="local-1627442001"><a href="#local-1627442001"><span class="hs-identifier">pr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><a href="Crypto.Random.html#newGen"><span class="hs-identifier hs-var">newGen</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getEntropy</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">proxy</span><span> </span><a href="Crypto.Random.html#genSeedLength"><span class="hs-identifier hs-var">genSeedLength</span></a><span> </span><a href="#local-1627442001"><span class="hs-identifier hs-var">pr</span></a><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>                </span><a name="local-1627442002"><a href="#local-1627442002"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627441999"><span class="hs-identifier hs-var">getTypedGen</span></a><span> </span><a href="#local-1627441998"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-177"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627442002"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-178"></a><span>                        </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627441996"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627441997"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>                        </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627442003"><a href="#local-1627442003"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627442003"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">asProxyTypeOf</span><span class="hs-special">`</span><span> </span><a href="#local-1627441998"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">-- |Get a random number generator based on the standard system entropy source</span><span>
</span><a name="line-182"></a><span class="hs-identifier">getSystemGen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Crypto.Random.html#SystemRandom"><span class="hs-identifier hs-type">SystemRandom</span></a><span>
</span><a name="line-183"></a><a name="getSystemGen"><a href="Crypto.Random.html#getSystemGen"><span class="hs-identifier">getSystemGen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-184"></a><span>        </span><a name="local-1627442061"><a href="#local-1627442061"><span class="hs-identifier">ch</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">openHandle</span><span>
</span><a name="line-185"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-1627442062"><a href="#local-1627442062"><span class="hs-identifier">getBS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeInterleaveIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-186"></a><span>                </span><a name="local-1627442063"><a href="#local-1627442063"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">hGetEntropy</span><span> </span><a href="#local-1627442061"><span class="hs-identifier hs-var">ch</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-operator hs-var">^</span><span class="hs-number">15</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>                </span><a name="local-1627442064"><a href="#local-1627442064"><span class="hs-identifier">more</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627442062"><span class="hs-identifier hs-var">getBS</span></a><span>
</span><a name="line-188"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627442063"><span class="hs-identifier hs-var">bs</span></a><span class="hs-glyph">:</span><a href="#local-1627442064"><span class="hs-identifier hs-var">more</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>        </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><a href="Crypto.Random.html#SysRandom"><span class="hs-identifier hs-var">SysRandom</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromChunks</span><span class="hs-special">)</span><span> </span><a href="#local-1627442062"><span class="hs-identifier hs-var">getBS</span></a><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-comment">-- |Not that it is technically correct as an instance of</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- 'CryptoRandomGen', but simply because it's a reasonable engineering</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- choice here is a CryptoRandomGen which streams the system</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- randoms. Take note:</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- </span><span>
</span><a name="line-196"></a><span class="hs-comment">--  * It uses the default definition of 'genByteWithEntropy'</span><span>
</span><a name="line-197"></a><span class="hs-comment">--</span><span>
</span><a name="line-198"></a><span class="hs-comment">--  * 'newGen' will always fail!</span><span>
</span><a name="line-199"></a><span class="hs-comment">--</span><span>
</span><a name="line-200"></a><span class="hs-comment">--  * 'reseed' will always fail!</span><span>
</span><a name="line-201"></a><span class="hs-comment">--</span><span>
</span><a name="line-202"></a><span class="hs-comment">--  * the handle to the system random is never closed</span><span>
</span><a name="line-203"></a><span class="hs-comment">--</span><span>
</span><a name="line-204"></a><span class="hs-keyword">data</span><span> </span><a name="SystemRandom"><a href="Crypto.Random.html#SystemRandom"><span class="hs-identifier">SystemRandom</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="SysRandom"><a href="Crypto.Random.html#SysRandom"><span class="hs-identifier">SysRandom</span></a></a><span> </span><span class="hs-identifier hs-type">L</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span class="hs-keyword">instance</span><span> </span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="Crypto.Random.html#SystemRandom"><span class="hs-identifier hs-type">SystemRandom</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-207"></a><span>  </span><a name="local-1912654636"><a href="Crypto.Random.html#newGen"><span class="hs-identifier">newGen</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="Crypto.Random.html#NeedsInfiniteSeed"><span class="hs-identifier hs-var">NeedsInfiniteSeed</span></a><span>
</span><a name="line-208"></a><span>  </span><a name="local-1912654637"><a href="Crypto.Random.html#genSeedLength"><span class="hs-identifier">genSeedLength</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tagged</span><span> </span><span class="hs-identifier hs-var">maxBound</span><span>
</span><a name="line-209"></a><span>  </span><a name="local-1912654638"><a href="Crypto.Random.html#genBytes"><span class="hs-identifier">genBytes</span></a></a><span> </span><a name="local-1627442072"><a href="#local-1627442072"><span class="hs-identifier">req</span></a></a><span> </span><span class="hs-special">(</span><a href="Crypto.Random.html#SysRandom"><span class="hs-identifier hs-var">SysRandom</span></a><span> </span><a name="local-1627442073"><a href="#local-1627442073"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1627442074"><a href="#local-1627442074"><span class="hs-identifier">reqI</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-1627442072"><span class="hs-identifier hs-var">req</span></a><span>
</span><a name="line-211"></a><span>        </span><a name="local-1627442075"><a href="#local-1627442075"><span class="hs-identifier">rnd</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-1627442074"><span class="hs-identifier hs-var">reqI</span></a><span> </span><a href="#local-1627442073"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-212"></a><span>        </span><a name="local-1627442076"><a href="#local-1627442076"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">drop</span><span> </span><a href="#local-1627442074"><span class="hs-identifier hs-var">reqI</span></a><span> </span><a href="#local-1627442073"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-213"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627442075"><span class="hs-identifier hs-var">rnd</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1627442074"><span class="hs-identifier hs-var">reqI</span></a><span>
</span><a name="line-214"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">L</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toChunks</span><span> </span><a href="#local-1627442075"><span class="hs-identifier hs-var">rnd</span></a><span class="hs-special">,</span><span> </span><a href="Crypto.Random.html#SysRandom"><span class="hs-identifier hs-var">SysRandom</span></a><span> </span><a href="#local-1627442076"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span>
</span><a name="line-215"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="Crypto.Random.html#RequestedTooManyBytes"><span class="hs-identifier hs-var">RequestedTooManyBytes</span></a><span>
</span><a name="line-216"></a><span>  </span><a name="local-1912654642"><a href="Crypto.Random.html#reseed"><span class="hs-identifier">reseed</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="Crypto.Random.html#NeedsInfiniteSeed"><span class="hs-identifier hs-var">NeedsInfiniteSeed</span></a><span>
</span><a name="line-217"></a><span>  </span><a name="local-1912654643"><a href="Crypto.Random.html#newGenIO"><span class="hs-identifier">newGenIO</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.html#getSystemGen"><span class="hs-identifier hs-var">getSystemGen</span></a><span>
</span><a name="line-218"></a><span>  </span><a name="local-1912654639"><a href="Crypto.Random.html#reseedInfo"><span class="hs-identifier">reseedInfo</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.html#Never"><span class="hs-identifier hs-var">Never</span></a><span>
</span><a name="line-219"></a><span>  </span><a name="local-1912654640"><a href="Crypto.Random.html#reseedPeriod"><span class="hs-identifier">reseedPeriod</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.html#Never"><span class="hs-identifier hs-var">Never</span></a><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-comment">-- | While the safety and wisdom of a splitting function depends on the</span><span>
</span><a name="line-222"></a><span class="hs-comment">-- properties of the generator being split, several arguments from</span><span>
</span><a name="line-223"></a><span class="hs-comment">-- informed people indicate such a function is safe for NIST SP 800-90</span><span>
</span><a name="line-224"></a><span class="hs-comment">-- generators.  (see libraries\@haskell.org discussion around Sept, Oct</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- 2010).  You can find implementations of such generators in the 'DRBG'</span><span>
</span><a name="line-226"></a><span class="hs-comment">-- package.</span><span>
</span><a name="line-227"></a><span class="hs-identifier">splitGen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Crypto.Random.html#CryptoRandomGen"><span class="hs-identifier hs-type">CryptoRandomGen</span></a><span> </span><a href="#local-1627442004"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627442004"><span class="hs-identifier hs-type">g</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Crypto.Random.html#GenError"><span class="hs-identifier hs-type">GenError</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627442004"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">,</span><a href="#local-1627442004"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-228"></a><a name="splitGen"><a href="Crypto.Random.html#splitGen"><span class="hs-identifier">splitGen</span></a></a><span> </span><a name="local-1627442065"><a href="#local-1627442065"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-229"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1627442066"><a href="#local-1627442066"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Crypto.Random.html#genBytes"><span class="hs-identifier hs-var">genBytes</span></a><span> </span><span class="hs-special">(</span><a href="Crypto.Random.html#genSeedLength"><span class="hs-identifier hs-var">genSeedLength</span></a><span> </span><span class="hs-special">`</span><a href="Crypto.Util.html#for"><span class="hs-identifier hs-var">for</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627442065"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627442065"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-230"></a><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627442066"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627442067"><a href="#local-1627442067"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627442067"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-232"></a><span>    </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-1627442068"><a href="#local-1627442068"><span class="hs-identifier">ent</span></a></a><span class="hs-special">,</span><a name="local-1627442069"><a href="#local-1627442069"><span class="hs-identifier">g'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><a name="line-233"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="Crypto.Random.html#newGen"><span class="hs-identifier hs-var">newGen</span></a><span> </span><a href="#local-1627442068"><span class="hs-identifier hs-var">ent</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-234"></a><span>                </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627442070"><a href="#local-1627442070"><span class="hs-identifier">new</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-1627442069"><span class="hs-identifier hs-var">g'</span></a><span class="hs-special">,</span><a href="#local-1627442070"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>                </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627442071"><a href="#local-1627442071"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627442071"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-236"></a></pre></body></html>